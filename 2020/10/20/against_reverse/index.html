<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>反逆向分析 | I0gan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="反逆向分析Ollvm0x01 Ollvm介绍OLLVM（Obfuscator-LLVM）是瑞士西北应用科技大学安全实验室于2010年6月份发起的一个项目，该项目旨在提供一套开源的针对LLVM的代码混淆工具，以增加逆向工程的难度, 只不过Ollvm仅更新到llvm的4.0，2017年开始就没再更新。 0x02 Ollvm混淆介绍Ollvm混淆主要分成三种模式，这三种模式主要是流程平坦化，指令替换，以">
<meta property="og:type" content="article">
<meta property="og:title" content="反逆向分析">
<meta property="og:url" content="http://blog.i0gan.cn/2020/10/20/against_reverse/index.html">
<meta property="og:site_name" content="I0gan">
<meta property="og:description" content="反逆向分析Ollvm0x01 Ollvm介绍OLLVM（Obfuscator-LLVM）是瑞士西北应用科技大学安全实验室于2010年6月份发起的一个项目，该项目旨在提供一套开源的针对LLVM的代码混淆工具，以增加逆向工程的难度, 只不过Ollvm仅更新到llvm的4.0，2017年开始就没再更新。 0x02 Ollvm混淆介绍Ollvm混淆主要分成三种模式，这三种模式主要是流程平坦化，指令替换，以">
<meta property="og:locale">
<meta property="article:published_time" content="2020-10-20T10:24:50.000Z">
<meta property="article:modified_time" content="2020-10-25T04:08:26.936Z">
<meta property="article:author" content="i0gan">
<meta property="article:tag" content="reverse">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="I0gan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">I0gan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.i0gan.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-against_reverse" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/20/against_reverse/" class="article-date">
  <time datetime="2020-10-20T10:24:50.000Z" itemprop="datePublished">2020-10-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/reverse/">reverse</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      反逆向分析
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="反逆向分析"><a href="#反逆向分析" class="headerlink" title="反逆向分析"></a>反逆向分析</h1><h2 id="Ollvm"><a href="#Ollvm" class="headerlink" title="Ollvm"></a>Ollvm</h2><h3 id="0x01-Ollvm介绍"><a href="#0x01-Ollvm介绍" class="headerlink" title="0x01 Ollvm介绍"></a>0x01 Ollvm介绍</h3><p>OLLVM（Obfuscator-LLVM）是瑞士西北应用科技大学安全实验室于2010年6月份发起的一个项目，该项目旨在提供一套<strong>开源的针对LLVM的代码混淆工具</strong>，以增加逆向工程的难度, 只不过Ollvm仅更新到llvm的4.0，2017年开始就没再更新。</p>
<h3 id="0x02-Ollvm混淆介绍"><a href="#0x02-Ollvm混淆介绍" class="headerlink" title="0x02 Ollvm混淆介绍"></a>0x02 Ollvm混淆介绍</h3><p>Ollvm混淆主要分成三种模式，这三种模式主要是流程平坦化，指令替换，以及控制流伪造。</p>
<p><strong>流程平坦化</strong> ：这个模式主要通过将if-else语句替换成do-while语句，然后通过switch语句来对流程的控制，这样就能模糊基本块之间的前后关系。</p>
<p><strong>指令替换</strong> ：这个模式主要通过使用更复杂的指令序列来替换一些标准的二元运算符，从而增加逆向的难度。</p>
<p><strong>控制流伪造</strong> ：这个模式主要是会在一个简单的运算中外包好几层if-else的判断，从而增加逆向的难度。</p>
<blockquote>
<p>对Ollvm有更深入的理解，可参阅论文《Obfuscating C++ programs via control flow flattening》</p>
</blockquote>
<h3 id="0x03-Ollvm编译"><a href="#0x03-Ollvm编译" class="headerlink" title="0x03 Ollvm编译"></a>0x03 Ollvm编译</h3><p>env: arch-linux</p>
<p>使用apt源安装g++和cmake，从github获取ollvm的源码，并进行编译。</p>
<p>Ollvm 6.0: <a target="_blank" rel="noopener" href="https://github.com/yazhiwang/ollvm-tll.git">https://github.com/yazhiwang/ollvm-tll.git</a> (编译成功!)</p>
<p>原版src: <a target="_blank" rel="noopener" href="https://github.com/obfuscator-llvm/obfuscator/tree/llvm-4.0">https://github.com/obfuscator-llvm/obfuscator/tree/llvm-4.0</a>  (编译失败!)</p>
<h4 id="ollvm-til编译"><a href="#ollvm-til编译" class="headerlink" title="ollvm-til编译"></a>ollvm-til编译</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release ../ollvm-tll-master</span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure>



<h4 id="官方编译"><a href="#官方编译" class="headerlink" title="官方编译"></a>官方编译</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> </span><br><span class="line">mkdir build</span><br><span class="line">cmake  -DCMAKE_BUILD_TYPE=Release  -DLLVM_INCLUDE_TESTS=OFF  ../</span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure>

<h3 id="0x4-命令介绍"><a href="#0x4-命令介绍" class="headerlink" title="0x4 命令介绍"></a>0x4 命令介绍</h3><h4 id="控制流扁平化"><a href="#控制流扁平化" class="headerlink" title="控制流扁平化"></a>控制流扁平化</h4><p>这个模式主要是把一些if-else语句，嵌套成do-while语句</p>
<p> -mllvm -fla：激活控制流扁平化</p>
<p> -mllvm -split：激活基本块分割。在一起使用时改善展平。</p>
<p> -mllvm -split_num=3：如果激活了传递，则在每个基本块上应用3次。默认值：1</p>
<h4 id="指令替换"><a href="#指令替换" class="headerlink" title="指令替换"></a>指令替换</h4><p>这个模式主要用功能上等效但更复杂的指令序列替换标准二元运算符(+ , – , &amp; , | 和 ^)</p>
<p> -mllvm -sub：激活指令替换</p>
<p> -mllvm -sub_loop=3：如果激活了传递，则在函数上应用3次。默认值：1</p>
<h4 id="虚假控制流程"><a href="#虚假控制流程" class="headerlink" title="虚假控制流程"></a>虚假控制流程</h4><p>这个模式主要嵌套几层判断逻辑，一个简单的运算都会在外面包几层if-else，所以这个模式加上编译速度会慢很多因为要做几层假的逻辑包裹真正有用的代码。</p>
<p> -mllvm -bcf：激活虚假控制流程<br> -mllvm -bcf_loop=3：如果激活了传递，则在函数上应用3次。默认值：1<br> -mllvm -bcf_prob=40：如果激活了传递，基本块将以40％的概率进行模糊处理。默认值：30</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p> -mllvm -sobf 开启字符串混淆</p>
<p> -mllvm -seed=0xdeadbeaf 指定随机数种子生成器 bcf可以配合下面参数使用</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>对a.c进行混淆</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exec</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;OOOKKKK!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    a ++;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(a &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        exec();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/tools/ollvm/bin/clang a.c -mllvm -fla  -mllvm -sobf  -mllvm -bcf  -o a</span><br></pre></td></tr></table></figure>

<p>ida64打开F5</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  __int64 *v4; <span class="comment">// rcx</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v6; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v8; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  __int64 *v11; <span class="comment">// rcx</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// eax</span></span><br><span class="line">  __int64 v13; <span class="comment">// [rsp+0h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [rsp+Ch] [rbp-44h]</span></span><br><span class="line">  __int64 *v16; <span class="comment">// [rsp+10h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  <span class="keyword">int</span> v18; <span class="comment">// [rsp+1Ch] [rbp-34h]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">int</span> v20; <span class="comment">// [rsp+24h] [rbp-2Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v21; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">int</span> v22; <span class="comment">// [rsp+2Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> v23; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v24; <span class="comment">// [rsp+34h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v25; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v26; <span class="comment">// [rsp+3Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v27; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">bool</span> v28; <span class="comment">// [rsp+45h] [rbp-Bh]</span></span><br><span class="line">  <span class="keyword">bool</span> v29; <span class="comment">// [rsp+46h] [rbp-Ah]</span></span><br><span class="line">  <span class="keyword">bool</span> v30; <span class="comment">// [rsp+47h] [rbp-9h]</span></span><br><span class="line"></span><br><span class="line">  v28 = (((_BYTE)x_2 - <span class="number">1</span>) * (_BYTE)x_2 &amp; <span class="number">1</span>) == <span class="number">0</span>;</span><br><span class="line">  v29 = y_3 &lt; <span class="number">10</span>;</span><br><span class="line">  v27 = <span class="number">1567572003</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v26 = v27;</span><br><span class="line">        v25 = v27 + <span class="number">1130483098</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v27 != <span class="number">-1130483098</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v9 = <span class="number">-1065940243</span>;</span><br><span class="line">        <span class="keyword">if</span> ( y_3 &lt; <span class="number">10</span> || (((_BYTE)x_2 - <span class="number">1</span>) * (_BYTE)x_2 &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v9 = <span class="number">-714366873</span>;</span><br><span class="line">        v27 = v9;</span><br><span class="line">      &#125;</span><br><span class="line">      v24 = v26 + <span class="number">1065940243</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v26 != <span class="number">-1065940243</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v27 = <span class="number">-1130483098</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v23 = v26 + <span class="number">714366873</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v26 == <span class="number">-714366873</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v22 = v26 + <span class="number">511865542</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v26 == <span class="number">-511865542</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = <span class="number">-1065940243</span>;</span><br><span class="line">      <span class="keyword">if</span> ( y_3 &lt; <span class="number">10</span> || (((_BYTE)x_2 - <span class="number">1</span>) * (_BYTE)x_2 &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">        v8 = <span class="number">-1130483098</span>;</span><br><span class="line">      v27 = v8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v21 = v26 + <span class="number">329192939</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v26 == <span class="number">-329192939</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v11 = &amp;v13 - <span class="number">2</span>;</span><br><span class="line">        *((_DWORD *)&amp;v13 - <span class="number">4</span>) = <span class="number">0</span>;</span><br><span class="line">        *(_DWORD *)v11 = <span class="number">0</span>;</span><br><span class="line">        *(_DWORD *)v11 = *((_DWORD *)&amp;v13 - <span class="number">4</span>) + <span class="number">1</span>;</span><br><span class="line">        v12 = <span class="built_in">printf</span>(&amp;byte_404030);</span><br><span class="line">        v27 = <span class="number">191033970</span>;</span><br><span class="line">        v14 = v12;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v20 = v26 - <span class="number">191033970</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v26 == <span class="number">191033970</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v4 = &amp;v13 - <span class="number">2</span>;</span><br><span class="line">          *((_DWORD *)&amp;v13 - <span class="number">4</span>) = <span class="number">0</span>;</span><br><span class="line">          *(_DWORD *)v4 = <span class="number">0</span>;</span><br><span class="line">          *(_DWORD *)v4 = *((_DWORD *)&amp;v13 - <span class="number">4</span>) + <span class="number">1</span>;</span><br><span class="line">          v16 = &amp;v13 - <span class="number">2</span>;</span><br><span class="line">          v5 = <span class="built_in">printf</span>(&amp;byte_404030);</span><br><span class="line">          v6 = <span class="number">-329192939</span>;</span><br><span class="line">          v30 = *(_DWORD *)v16 &gt;= <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">if</span> ( y_3 &lt; <span class="number">10</span> || (((_BYTE)x_2 - <span class="number">1</span>) * (_BYTE)x_2 &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">            v6 = <span class="number">1347608926</span>;</span><br><span class="line">          v27 = v6;</span><br><span class="line">          v15 = v5;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v19 = v26 - <span class="number">1347608926</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v26 == <span class="number">1347608926</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v7 = <span class="number">-511865542</span>;</span><br><span class="line">            <span class="keyword">if</span> ( v30 )</span><br><span class="line">              v7 = <span class="number">1700479422</span>;</span><br><span class="line">            v27 = v7;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            v18 = v26 - <span class="number">1567572003</span>;</span><br><span class="line">            <span class="keyword">if</span> ( v26 == <span class="number">1567572003</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              v3 = <span class="number">-329192939</span>;</span><br><span class="line">              <span class="keyword">if</span> ( v29 || v28 )</span><br><span class="line">                v3 = <span class="number">191033970</span>;</span><br><span class="line">              v27 = v3;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              v17 = v26 - <span class="number">1700479422</span>;</span><br><span class="line">              <span class="keyword">if</span> ( v26 == <span class="number">1700479422</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                exec();</span><br><span class="line">                v27 = <span class="number">-511865542</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上成功实现代码混淆</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="http://ac.inf.elte.hu/Vol_030_2009/003.pdf">Obfuscating C++ programs via control flow flattening </a></p>
<h2 id="去除符号表"><a href="#去除符号表" class="headerlink" title="去除符号表"></a>去除符号表</h2><p>查看符号表</p>
<p>  readelf -s test</p>
<p>采用strip工具对符号表进行去除</p>
<p>.symtab因为是在调试和链接时有用的，所以，可以从生产的二进制执行文件中移除。可以使用strip。strip是可以移除符号以及节的工具。</p>
<ol>
<li><p>移除.symtab 符号表 以及 .strtab 符号字符串表<br>直接运行</p>
<ul>
<li><code>strip --remove-section=.symtab file_in</code></li>
<li><code>strip --remove-section=.strtab file_in</code></li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>想要让可执行文件没有<code>.dynsym</code>动态链接表，<code>.dynstr</code>动态链接字符表。<br>gcc编译时添加参数，从而使用静态编译。<code>gcc -static</code> 或者 <code>gcc -nostdlib</code></p>
<ul>
<li><code>gcc -nostdlib</code> ：不连接系统标准启动文件和标准库文件，只把指定的文件传递给连接器。</li>
<li><code>gcc -static</code>：在支持动态链接的系统上，阻止连接共享库。该选项在其它系统上 无效。</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.i0gan.cn/2020/10/20/against_reverse/" data-id="ckhemv7z70001wdcma93c53cb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reverse/" rel="tag">reverse</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/10/25/weekly-report-2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          weekly-report-2
        
      </div>
    </a>
  
  
    <a href="/2020/10/18/wp-nu1lctf-2020/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">wp-nu1lctf-2020</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/dev/">dev</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/exploit/">exploit</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/pwn/">pwn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/reverse/">reverse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/summary/">summary</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vul/">vul</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awd/" rel="tag">awd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/" rel="tag">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metasploit/" rel="tag">metasploit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn-env/" rel="tag">pwn-env</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/" rel="tag">reverse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vul/" rel="tag">vul</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weekly-summary/" rel="tag">weekly summary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/android/" style="font-size: 12.5px;">android</a> <a href="/tags/awd/" style="font-size: 10px;">awd</a> <a href="/tags/dev/" style="font-size: 10px;">dev</a> <a href="/tags/docker/" style="font-size: 12.5px;">docker</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/hexo/" style="font-size: 12.5px;">hexo</a> <a href="/tags/kernel/" style="font-size: 12.5px;">kernel</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/linux/" style="font-size: 17.5px;">linux</a> <a href="/tags/metasploit/" style="font-size: 10px;">metasploit</a> <a href="/tags/pwn/" style="font-size: 12.5px;">pwn</a> <a href="/tags/pwn-env/" style="font-size: 10px;">pwn-env</a> <a href="/tags/reverse/" style="font-size: 10px;">reverse</a> <a href="/tags/vul/" style="font-size: 10px;">vul</a> <a href="/tags/weekly-summary/" style="font-size: 12.5px;">weekly summary</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/wp/" style="font-size: 20px;">wp</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/08/tiesan-2020/">tiesan-2020</a>
          </li>
        
          <li>
            <a href="/2020/11/08/wp-other/">wp-thb-2020</a>
          </li>
        
          <li>
            <a href="/2020/11/06/wp-nssc-2020/">wp-nssc-2020</a>
          </li>
        
          <li>
            <a href="/2020/11/01/weekly-report-3/">weekly-report-3</a>
          </li>
        
          <li>
            <a href="/2020/11/01/wp-xhb-2020/">湖湘杯2020</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 i0gan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>